# Amaidesu é…ç½®æ–‡ä»¶
#
# ğŸ“ é…ç½®å±‚æ¬¡è¯´æ˜
# ================================
# æ­¤é…ç½®æ–‡ä»¶æ˜¯ç”¨æˆ·ä¸»é…ç½®ï¼ŒåŒ…å«ï¼š
# 1. å…¨å±€é…ç½®ï¼ˆLLMã€MaiCoreè¿æ¥ç­‰ï¼‰
# 2. Providerå¯ç”¨åˆ—è¡¨
# 3. å¸¸ç”¨å‚æ•°è¦†ç›–ï¼ˆå¯é€‰ï¼‰
#
# å„Providerçš„è¯¦ç»†é…ç½®åœ¨å„è‡ªçš„ config.toml ä¸­ï¼š
# - src/domains/{domain}/providers/{provider}/config.toml

# ========== å…¨å±€LLMé…ç½® ==========

# æ ‡å‡† LLM é…ç½®ï¼ˆç”¨äºé«˜è´¨é‡ä»»åŠ¡ï¼‰
[llm]
backend = "openai"              # openai | ollama | anthropic
model = "Pro/deepseek-ai/DeepSeek-V3.2"
temperature = 0.2
api_key = "your-api-key"                    # å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®å°†ä½¿ç”¨ç¯å¢ƒå˜é‡
base_url = "https://api.siliconflow.cn/v1/" # å¯é€‰ï¼Œç”¨äºè‡ªå®šä¹‰APIç«¯ç‚¹
max_tokens = 1024
max_retries = 3                 # å¯é€‰ï¼Œé»˜è®¤ 3
retry_delay = 1.0               # å¯é€‰ï¼Œé»˜è®¤ 1.0

# å¿«é€Ÿ LLM é…ç½®ï¼ˆç”¨äºä½å»¶è¿Ÿä»»åŠ¡ï¼Œå¦‚ Avatar è¡¨æƒ…åˆ†æï¼‰
[llm_fast]
backend = "openai"
model = "Qwen/Qwen3-8B"
temperature = 0.2
api_key = "your-api-key"
base_url = "https://api.siliconflow.cn/v1/"
max_tokens = 1024

# è§†è§‰è¯­è¨€æ¨¡å‹é…ç½®ï¼ˆç”¨äºå›¾åƒç†è§£ä»»åŠ¡ï¼‰
[vlm]
backend = "openai"
model = "zai-org/GLM-4.6V"
temperature = 0.3
api_key = "your-api-key"
base_url = "https://api.siliconflow.cn/v1/"
max_tokens = 1024

# æœ¬åœ° Ollama é…ç½®ï¼ˆå¯é€‰ï¼‰
[llm_local]
backend = "ollama"
model = "llama3"
api_base = "http://localhost:11434/v1"
api_key = "sk-dummy"            # Ollama ä¸éœ€è¦çœŸå® API key

# ========== Amaidesuæ ¸å¿ƒé…ç½® ==========

[general]
# Amaidesu åœ¨ MaiCore ä¸­æ³¨å†Œçš„å¹³å°æ ‡è¯†ç¬¦
platform_id = "amaidesu"

[maicore]
# MaiCore WebSocket æœåŠ¡å™¨åœ°å€
host = "127.0.0.1"
# MaiCore WebSocket æœåŠ¡å™¨ç«¯å£
port = 8000
# token = "your_maicore_token_if_needed" # å¦‚æœ MaiCore éœ€è¦è®¤è¯ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½®

# è®¯é£ RTASR å®æ—¶è¯†åˆ«å‡­æ®ï¼ˆå¯é€‰ï¼‰
[spark_rtasr]
app_id = ""
access_key_id = ""
access_key_secret = ""
# å¯é€‰ï¼šè‡ªå®šä¹‰ websocket URLï¼ˆé»˜è®¤å®˜æ–¹åœ°å€ï¼‰
# ws_url = "wss://office-api-ast-dx.iflyaisol.com/ast/communicate/v1"

# HTTPå›è°ƒæœåŠ¡å™¨é…ç½®
[http_server]
enable = true
host = "127.0.0.1"
port = 8080
callback_path = "/maicore_callback"

# ========== æ—¥å¿—é…ç½® ==========

[logging]
# æ˜¯å¦å¯ç”¨æ–‡ä»¶æ—¥å¿—
enabled = true
# æ—¥å¿—æ ¼å¼: jsonl (JSON Lines) æˆ– text (çº¯æ–‡æœ¬)
format = "jsonl"
# æ—¥å¿—æ–‡ä»¶ç›®å½• (ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•)
directory = "logs"
# æœ€å°æ—¥å¿—çº§åˆ«: TRACE | DEBUG | INFO | WARNING | ERROR | CRITICAL
level = "INFO"
# æ–‡ä»¶è½®è½¬è§¦å‘æ¡ä»¶: "10 MB", "1 day", "00:00", "weekly", "monthly"
rotation = "10 MB"
# æ—¥å¿—ä¿ç•™æ—¶é—´: "7 days", "1 week", "1 month", "1 year"
retention = "7 days"
# å‹ç¼©æ ¼å¼: "zip", "gz", "tar", "" (ç¦ç”¨)
compression = "zip"
# æ˜¯å¦æŒ‰ä¼šè¯åˆ†å‰²æ—¥å¿—æ–‡ä»¶ï¼ˆé»˜è®¤ï¼šfalseï¼‰
# å¯ç”¨åï¼Œæ¯æ¬¡å¯åŠ¨ç”Ÿæˆæ–°æ–‡ä»¶ï¼ˆæ–‡ä»¶ååŒ…å«æ—¶åˆ†ç§’ï¼Œå¦‚ amaidesu_20260207_150423.jsonlï¼‰
# ç¦ç”¨æ—¶ï¼ŒåŒä¸€å¤©å¤šæ¬¡å¯åŠ¨ä¼šè¿½åŠ åˆ°åŒä¸€æ–‡ä»¶ï¼ˆå¦‚ amaidesu_2026-02-07.jsonlï¼‰
split_by_session = false

# ä¸Šä¸‹æ–‡ç®¡ç†å™¨é…ç½®
[context_manager]
enabled = true

[context_manager.formatting]
separator = "\n"           # ä¸Šä¸‹æ–‡é¡¹ä¹‹é—´çš„åˆ†éš”ç¬¦
add_provider_title = false # æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡å‰æ·»åŠ æä¾›è€…åç§°
title_separator = ": "     # å¦‚æœæ·»åŠ æä¾›è€…åç§°ï¼Œä½¿ç”¨çš„åˆ†éš”ç¬¦

[context_manager.limits]
default_max_length = 1000  # é»˜è®¤ä¸Šä¸‹æ–‡æœ€å¤§é•¿åº¦
default_priority = 100     # é»˜è®¤ä¼˜å…ˆçº§å€¼

# ========== ç®¡é“é…ç½® ==========

[pipelines]
# TextPipeline ç¤ºä¾‹ï¼šé™æµ
# [pipelines.rate_limit]
# priority = 100
# global_rate_limit = 100  # å…¨å±€æ¯åˆ†é’Ÿæœ€å¤§æ¶ˆæ¯æ•°
# user_rate_limit = 10     # æ¯ä¸ªç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§æ¶ˆæ¯æ•°
# window_size = 60         # æ»‘åŠ¨çª—å£å¤§å°ï¼ˆç§’ï¼‰

# TextPipeline ç¤ºä¾‹ï¼šé™æµ
[pipelines.rate_limit]
priority = 100
enabled = true
global_rate_limit = 100
user_rate_limit = 10
window_size = 60

# TextPipeline ç¤ºä¾‹ï¼šç›¸ä¼¼æ¶ˆæ¯è¿‡æ»¤
[pipelines.similar_filter]
priority = 500
enabled = true
similarity_threshold = 0.85
time_window = 5.0

# === è¾“å‡ºç®¡é“ï¼ˆOutputPipelineï¼‰===
# OutputPipeline ç¤ºä¾‹ï¼šæ•æ„Ÿè¯è¿‡æ»¤
[pipelines.profanity_filter]
# OutputPipeline é…ç½®
[pipelines.profanity_filter.output]
enabled = true
priority = 100
# æ•æ„Ÿè¯åˆ—è¡¨
words = ["æµ‹è¯•è„è¯", "ç¤ºä¾‹æ•æ„Ÿè¯"]
replacement = "***"
# å¯é€‰ï¼šä»æ–‡ä»¶åŠ è½½
# wordlist_file = "data/profanity_words.txt"
# æ˜¯å¦è¿‡æ»¤ TTS æ–‡æœ¬ï¼ˆé»˜è®¤ï¼štrueï¼‰
filter_tts = true
# æ˜¯å¦è¿‡æ»¤å­—å¹•æ–‡æœ¬ï¼ˆé»˜è®¤ï¼štrueï¼‰
filter_subtitle = true
# æ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼ˆé»˜è®¤ï¼šfalseï¼‰
case_sensitive = false
# åŒ¹é…åˆ°æ•æ„Ÿè¯æ˜¯å¦ä¸¢å¼ƒæ•´ä¸ªæ¶ˆæ¯ï¼ˆé»˜è®¤ï¼šfalseï¼‰
drop_on_match = false

# ========== Provideré…ç½® ==========

# === è¾“å…¥Providerï¼ˆInput Domain: è¾“å…¥åŸŸï¼‰ ===
[providers.input]
enabled = true
# å¯ç”¨çš„è¾“å…¥Provideråˆ—è¡¨
enabled_inputs = [
    # æ§åˆ¶å°è¾“å…¥ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
    # "console_input",

    # Bç«™å¼¹å¹•è¾“å…¥
    # "bili_danmaku",           # æ™®é€šBç«™å¼¹å¹•
    # "bili_danmaku_official",  # Bç«™å®˜æ–¹å¼¹å¹•ï¼ˆä¸è¦å’Œbili_danmakuåŒæ—¶å¯ç”¨ï¼‰
    # "bili_danmaku_selenium",  # Bç«™å¼¹å¹•-Seleniumç‰ˆ

    # å…¶ä»–è¾“å…¥
    # "mock_danmaku",           # æ¨¡æ‹Ÿå¼¹å¹•
    # "read_pingmu",            # è¯»å±æœ¨
]

# å¸¸ç”¨å‚æ•°è¦†ç›–ï¼ˆå¯é€‰ï¼‰
# [providers.input.overrides]
# bili_danmaku.room_id = "123456"

# === è¾“å‡ºProviderï¼ˆOutput Domain: è¾“å‡ºåŸŸï¼‰ ===
[providers.output]
enabled = true
concurrent_rendering = true          # æ˜¯å¦å¹¶å‘æ¸²æŸ“åˆ°å¤šä¸ªProvider
error_handling = "continue"          # é”™è¯¯å¤„ç†ç­–ç•¥: continueï¼ˆç»§ç»­ï¼‰ | stopï¼ˆåœæ­¢ï¼‰
render_timeout = 10.0                # å•ä¸ªProvideræ¸²æŸ“è¶…æ—¶ï¼ˆç§’ï¼‰ï¼Œ0è¡¨ç¤ºä¸é™åˆ¶

# å¯ç”¨çš„è¾“å‡ºProvideråˆ—è¡¨
enabled_outputs = [
    # åŸºç¡€è¾“å‡ºï¼ˆæ¨èå¯ç”¨ï¼‰
    "subtitle",     # å­—å¹•
    "vts",          # VTSæ§åˆ¶

    # TTSè¾“å‡ºï¼ˆé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªï¼‰
    # "tts",         # Edge TTS
    # "omni_tts",    # Omni TTS (GPT-SoVITS)

    # å…¶ä»–è¾“å‡º
    # "sticker",     # è¡¨æƒ…è´´çº¸
]

# ExpressionGeneratoré…ç½®
[providers.output.expression_generator]
default_tts_enabled = true
default_subtitle_enabled = true
default_expressions_enabled = true
default_hotkeys_enabled = true

# å¸¸ç”¨å‚æ•°è¦†ç›–ï¼ˆå¯é€‰ï¼‰
# [providers.output.overrides]
# subtitle.font_size = 32
# subtitle.window_width = 1000
# vts.vts_host = "192.168.1.100"
# tts.voice = "zh-CN-YunxiNeural"

# === å†³ç­–Providerï¼ˆDecision Domain: å†³ç­–åŸŸï¼‰ ===
[providers.decision]
enabled = true
# å½“å‰ä½¿ç”¨çš„å†³ç­–Provider
active_provider = "maicore"
# æ”¯æŒçš„å†³ç­–Provideråˆ—è¡¨ï¼ˆç”¨äºè¿è¡Œæ—¶åˆ‡æ¢éªŒè¯ï¼‰
available_providers = [
    "maicore",        # MaiCoreå†³ç­–ï¼ˆé»˜è®¤ï¼Œé€šè¿‡WebSocketè¿æ¥MaiCoreï¼‰
    "rule_engine",    # è§„åˆ™å¼•æ“ï¼ˆæœ¬åœ°è§„åˆ™åŒ¹é…ï¼Œä½å»¶è¿Ÿï¼‰
    "local_llm",      # æœ¬åœ°LLMï¼ˆç›´æ¥è°ƒç”¨LLMç”Ÿæˆå›å¤ï¼‰
    "mock",           # æ¨¡æ‹ŸProviderï¼ˆç”¨äºæµ‹è¯•ï¼‰
]

# MaiCore DecisionProvider é…ç½®
[providers.decision.maicore]
# MaiCore WebSocket æœåŠ¡å™¨åœ°å€ï¼ˆç»§æ‰¿ [maicore] é…ç½®ï¼‰
# host = "127.0.0.1"
# port = 8000

# MaiCore DecisionProvider å­é…ç½®
[providers.decision.providers.maicore]
# Action å»ºè®®é…ç½®
# action_suggestions_enabled = false  # æ˜¯å¦å¯ç”¨ MaiBot Action å»ºè®®ï¼ˆé»˜è®¤å…³é—­ï¼‰
# action_confidence_threshold = 0.6   # æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ0.0-1.0ï¼‰
# action_cooldown_seconds = 5.0       # åŒä¸€ Action çš„æœ€å°é—´éš”ï¼ˆç§’ï¼‰
# max_suggested_actions = 3           # æ¯æ¡æ¶ˆæ¯æœ€å¤§å»ºè®®æ•°é‡

# LocalLLM DecisionProvider é…ç½®
[providers.decision.local_llm]
# ä½¿ç”¨çš„ LLM å®¢æˆ·ç«¯ç±»å‹
client_type = "llm"  # llm | llm_fast | vlm | llm_local
# ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿
prompt_template = """ä½ æ˜¯ä¸€ä¸ªAI VTuberã€‚æ ¹æ®ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆå›å¤ã€‚

è¾“å‡ºJSONæ ¼å¼ï¼š
{
  "response": "ä½ çš„å›å¤æ–‡æœ¬",
  "emotion": "happy|sad|angry|neutral|surprised|love",
  "actions": ["wave", ...]
}

ç”¨æˆ·æ¶ˆæ¯: {text}"""
# é™çº§æ¨¡å¼
fallback_mode = "simple"  # simpleï¼ˆè¿”å›åŸå§‹æ–‡æœ¬ï¼‰ | echoï¼ˆå›å£°ï¼‰ | errorï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰

# RuleEngine DecisionProvider é…ç½®
[providers.decision.rule_engine]
# è§„åˆ™æ–‡ä»¶è·¯å¾„
rules_file = "config/rules.json"
# é»˜è®¤å“åº”
default_response = "æˆ‘ä¸ç†è§£ä½ çš„æ„æ€"
# æ˜¯å¦åŒºåˆ†å¤§å°å†™
case_sensitive = false
# åŒ¹é…æ¨¡å¼
match_mode = "any"  # anyï¼ˆä»»ä¸€å…³é”®è¯åŒ¹é…ï¼‰ | allï¼ˆæ‰€æœ‰å…³é”®è¯åŒ¹é…ï¼‰

# Mock DecisionProvider é…ç½®
# [providers.decision.overrides]
# maicore.host = "192.168.1.100"
# local_llm.client_type = "llm_fast"
