# Phase 5: æ‰©å±•ç³»ç»Ÿé‡æ„ (14-18å¤©)

> **ç›®æ ‡**: å®ç°æ’ä»¶ç³»ç»Ÿ,è¿ç§»æ¸¸æˆæ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ,æä¾›ç¤¾åŒºå¼€å‘èƒ½åŠ›
> **ä¾èµ–**: Phase 1,2,3, 4å®Œæˆ
> **é£é™©**: ä¸­(æ’ä»¶æ•°é‡å¤š,éœ€è¦ä¿è¯æ¯ä¸ªæ’ä»¶æ­£ç¡®è¿ç§»)

---

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

æœ¬é˜¶æ®µå®ç°æ‰©å±•ç³»ç»Ÿ(æ’ä»¶ç³»ç»Ÿ),å°†23ä¸ªæ’ä»¶é‡æ–°åˆ†ç±»å’Œè¿ç§»:
1. æ ¸å¿ƒæ’ä»¶ â†’ å†…ç½®åˆ°src/extensions/
2. è¾“å…¥æ’ä»¶ â†’ è¿ç§»åˆ°Layer 1(Layer 1)ä½œä¸ºInputProvider
3. è¾“å‡ºæ’ä»¶ â†’ å·²åœ¨Phase 4å®Œæˆ
4. æ¸¸æˆäº¤äº’æ’ä»¶ â†’ è¿ç§»åˆ°src/extensions/ä½œä¸ºExtension
5. å¤„ç†å‹æ’ä»¶ â†’ è¿ç§»åˆ°src/extensions/ä½œä¸ºExtension
6. å…¶ä»–æ’ä»¶ â†’ è¿ç§»åˆ°src/extensions/ä½œä¸ºExtension

åŒæ—¶æä¾›Extensionæ¥å£,è®©ç¤¾åŒºå¼€å‘è€…å¯ä»¥å¼€å‘è‡ªå·±çš„æ‰©å±•ã€‚

---

## ğŸ¯ ä»»åŠ¡åˆ†è§£

### ä»»åŠ¡5.1: Extensionæ¥å£è®¾è®¡ (1-2å¤©)

**ç›®æ ‡**: å®šä¹‰Extensionæ¥å£,è§„èŒƒæ‰©å±•ç»“æ„

**èŒƒå›´**:
- [ ] `src/core/extension.py` - Extensionæ¥å£å®šä¹‰
- [ ] `src/core/extension_manager.py` - ExtensionManagerç±»
- [ ] `src/core/extension_factory.py` å·¥å‚æ¨¡å¼
- [ ] `src/core/extensions/__init__.py` - æ¨¡å—å¯¼å‡º

**æ¥å£è§„èŒƒ**:
```python
class Extension(Protocol):
    async def setup(self, event_bus: EventBus, config: dict) -> List[Provider]:
        """
        åˆå§‹åŒ–Extension
        
        Args:
            event_bus: äº‹ä»¶æ€»çº¿
            config: æ‰©å±•é…ç½®
        
        Returns:
            Provideråˆ—è¡¨: Extensionç®¡ç†çš„Provider
        """
        ...
    
    async def cleanup(self):
        """æ¸…ç†èµ„æº"""
        ...
    
    def get_info(self) -> Dict[str, Any]:
        """è·å–æ‰©å±•ä¿¡æ¯"""
        ...
    
    def get_dependencies(self) -> List[str]:
        """è·å–ä¾èµ–çš„å…¶ä»–æ‰©å±•åç§°"""
        ...
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] Extensionæ¥å£å®šä¹‰æ¸…æ™°
- [ ] ç±»å‹æ³¨è§£å®Œæ•´
- [ ] æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç é½å…¨
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%

---

### ä»»åŠ¡5.2: ExtensionManagerå®ç° (2-3å¤©)

**ç›®æ ‡**: ç®¡ç†æ‰€æœ‰Extension,æ”¯æŒè‡ªåŠ¨åŠ è½½å†…ç½®å’Œç¤¾åŒºæ‰©å±•

**èŒƒå›´**:
- [ ] `src/core/extension_manager.py` - ExtensionManagerç±»
- [ ] è‡ªåŠ¨æ‰«æsrc/extensions/å’Œextensions/ç›®å½•
- [ ] æ”¯æŒå¯ç”¨/ç¦ç”¨é…ç½®
- [ ] ä¾èµ–ç®¡ç†(æŒ‰ä¾èµ–é¡ºåºåŠ è½½)

**æ ¸å¿ƒåŠŸèƒ½**:
```python
class ExtensionManager:
    async def load_all_extensions(self, extensions_config: Dict[str, Dict]):
        """åŠ è½½æ‰€æœ‰Extension"""
    
    async def get_extension(self, name: str) -> Optional[Extension]:
        """è·å–Extensionå®ä¾‹"""
    
    async def unload_extension(self, name: str) -> bool:
        """å¸è½½Extension"""
    
    def get_loaded_extensions(self) -> List[str]:
        """è·å–æ‰€æœ‰å·²åŠ è½½çš„Extensionåç§°"""
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] src/extensions/å’Œextensions/æ‰«ææ­£å¸¸
- [ ] ä¾èµ–é¡ºåºæ­£ç¡®åŠ è½½
- [ ] å¯ç”¨/ç¦ç”¨é…ç½®ç”Ÿæ•ˆ
- [ ] å•ä¸ªExtensionå¸è½½æ­£å¸¸

---

### ä»»åŠ¡5.3: æ¸¸æˆæ‰©å±•è¿ç§» (3-4å¤©)

**ç›®æ ‡**: è¿ç§»æ¸¸æˆç›¸å…³æ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ

**èŒƒå›´**:
- [ ] `src/extensions/maicraft/` - Minecraftæ‰©å±•(ä»maicraftè¿ç§»)
- [ ] `src/extensions/mainosaba/` - ä¸»OSABAæ‰©å±•(ä»mainosabaè¿ç§»)
- [ ] `src/extensions/arknights/` - æ˜æ—¥æ–¹èˆŸæ‰©å±•(ä»arknightsè¿ç§»)
- [ ] `src/extensions/warudo/` - Warudoæ‰©å±•(ä»warudoè¿ç§»)

**è¿ç§»ç­–ç•¥**:
- ä¿æŒæ’ä»¶æ ¸å¿ƒåŠŸèƒ½ä¸å˜
- å°†æ’ä»¶ä½œä¸ºExtensionèšåˆå¤šä¸ªProvider
- é…ç½®ç»“æ„ä¿æŒå…¼å®¹,æ–°é…ç½®åˆ°æ—§é…ç½®çš„æ˜ å°„è§„åˆ™

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰æ¸¸æˆæ‰©å±•åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ¸¸æˆè¿æ¥ç¨³å®š
- [ ] æ¸¸æˆå‘½ä»¤æ‰§è¡Œæ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å®Œå–„

---

### ä»»åŠ¡5.4: è¾“å…¥æ‰©å±•è¿ç§» (2-3å¤©)

**ç›®æ ‡**: è¿ç§»è¾“å…¥å‹æ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ(é™¤å·²è¿ç§»çš„ConsoleInputå’ŒMockDanmaku)

**èŒƒå›´**:
- [ ] `src/extensions/bili_danmaku/` - Bç«™å¼¹å¹•æ‰©å±•(ä»bili_danmakuè¿ç§»)
- [ ] `src/extensions/bili_danmaku_official/` - Bç«™å®˜æ–¹å¼¹å¹•æ‰©å±•
- [ ] `src/extensions/bili_danmaku_selenium/` - Bç«™Seleniumå¼¹å¹•æ‰©å±•
- [ ] `src/extensions/funasr_stt/` - FunASRè¯­éŸ³è¯†åˆ«æ‰©å±•(ä»funasr_sttè¿ç§»)

**è¿ç§»ç­–ç•¥**:
- å°†æ’ä»¶ä½œä¸ºExtensionèšåˆInputProvider
- ä¿ç•™åŸæœ‰åŠŸèƒ½å’Œé…ç½®
- æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¿æœºåˆ¶

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰è¾“å…¥æ‰©å±•æ­£å¸¸å·¥ä½œ
- [ ] è¾“å…¥æ•°æ®é‡‡é›†æ­£å¸¸
- [ ] é‡è¿æœºåˆ¶æ­£å¸¸
- [ ] é…ç½®å…¼å®¹

---

### ä»»åŠ¡5.5: å¤„ç†å‹æ‰©å±•è¿ç§» (2-3å¤©)

**ç›®æ ‡**: è¿ç§»å¤„ç†å‹æ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ

**èŒƒå›´**:
- [ ] `src/extensions/llm_text_processor/` - LLMæ–‡æœ¬å¤„ç†æ‰©å±•
- [ ] `src/extensions/keyword_action/` - å…³é”®è¯åŠ¨ä½œæ‰©å±•
- [ ] `src/extensions/emotion_judge/` - æƒ…æ„Ÿåˆ¤æ–­æ‰©å±•
- [ ] `src/extensions/read_pingmu/` - è¯»å±æœ¨æ‰©å±•
- [ ] `src/extensions/dg_lab_service/` - DG-LabæœåŠ¡æ‰©å±•
- [ ] `src/extensions/dg-lab-do/` - DG-Lab DOæ‰©å±•
- [ ] `src/extensions/llm_text_processor/` - LLMæ–‡æœ¬å¤„ç†å™¨(ä»llm_text_processorè¿ç§»)

**è¿ç§»ç­–ç•¥**:
- ä¿ç•™å¤„ç†é€»è¾‘ä¸å˜
- å°†æ’ä»¶ä½œä¸ºExtensionèšåˆæœåŠ¡(æˆ–å¤šä¸ªProvider)
- ä¿ç•™é…ç½®å’ŒæœåŠ¡æ³¨å†Œ(ä½œä¸ºé™çº§æ–¹æ¡ˆ)

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å¤„ç†å‹æ‰©å±•åŠŸèƒ½æ­£å¸¸
- [ ] æœåŠ¡è°ƒç”¨å…¼å®¹
- [ ] é”™è¯¯å¤„ç†å®Œå–„

---

### ä»»åŠ¡5.6: è¾“å‡ºæ‰©å±•è¿ç§» (2-3å¤©)

**ç›®æ ‡**: è¿ç§»è¾“å‡ºå‹æ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ(é™¤å·²è¿ç§»çš„TTS/Subtitle/Sticker/VTS/OmniTTS)

**èŒƒå›´**:
- [ ] `src/extensions/tts/` - TTSæ‰©å±•(ä»ttsæ’ä»¶è¿ç§»)
- [ ] `src/extensions/subtitle/` - å­—å¹•æ‰©å±•(ä»subtitleæ’ä»¶è¿ç§»)
- [ ] `src/extensions/sticker/` - è´´çº¸æ‰©å±•(ä»stickeræ’ä»¶è¿ç§»)
- [ ] `src/extensions/vts/` - VTSæ‰©å±•(ä»vtube_studioæ’ä»¶è¿ç§»)
- [ ] `src/extensions/omni_tts/` - OmniTTSæ‰©å±•(ä»omni_ttsæ’ä»¶è¿ç§»)

**è¿ç§»ç­–ç•¥**:
- æ’ä»¶ä½œä¸ºExtensionèšåˆOutputProvider
- ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½(TTSå¼•æ“ã€çª—å£ç®¡ç†ã€UDPå¹¿æ’­ç­‰)
- ä¿æŒé…ç½®å…¼å®¹
- ä¿ç•™æœåŠ¡ä¾èµ–(text_cleanupã€vts_lip_syncç­‰)ä½œä¸ºé™çº§æ–¹æ¡ˆ

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰è¾“å‡ºæ‰©å±•åŠŸèƒ½æ­£å¸¸
- [ ] è¯­éŸ³åˆæˆè´¨é‡ä¿æŒ
- [ ] æ’­æ”¾ç¨³å®šæ€§é«˜
- [ ] èµ„æºç®¡ç†æ­£å¸¸

---

### ä»»åŠ¡5.7: å…¶ä»–æ‰©å±•è¿ç§» (2-3å¤©)

**ç›®æ ‡**: è¿ç§»å‰©ä½™æ’ä»¶åˆ°æ‰©å±•ç³»ç»Ÿ

**èŒƒå›´**:
- [ ] `src/extensions/remote_stream/` - è¿œç¨‹ä¸²æµæ‰©å±•
- [ ] `src/plugins/vrchat/` - VRChatæ§åˆ¶(ä»vrchatæ’ä»¶è¿ç§»)
- [ ] `src/plugins/obs_control/` - OBSæ§åˆ¶(ä»obs_controlæ’ä»¶è¿ç§»)

**è¿ç§»ç­–ç•¥**:
- æ’ä»¶ä½œä¸ºExtensionèšåˆProvider
- ä¿ç•™æ ¸å¿ƒåŠŸèƒ½
- ä¿ç•™é…ç½®å…¼å®¹

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å…¶ä»–æ‰©å±•åŠŸèƒ½æ­£å¸¸
- [ ] é…ç½®å…¼å®¹
- [ ] é”™è¯¯å¤„ç†å®Œå–„

---

## ğŸ”„ ä¾èµ–å…³ç³»

```
ä»»åŠ¡5.2: ExtensionManager
â”œâ”€ Phase 1: Provideræ¥å£
â”œâ”€ Phase 1: EventBus(å¢å¼º)
â”œâ”€ Phase 2: DataCache(å¯é€‰,ç”¨äºç¼“å­˜)
â”œâ”€ Phase 4: OutputProviderManager

ä»»åŠ¡5.3-5: æ¸¸æˆæ‰©å±•
â”œâ”€ ä»»åŠ¡5.2: Inputæ‰©å±•
â”œâ”€ Phase 2: InputLayer(é—´æ¥ä¾èµ–)
â””â”€ ä»»åŠ¡5.6: å¤„ç†å‹æ‰©å±•
    â”œâ”€ ä»»åŠ¡5.2: Inputæ‰©å±•(é—´æ¥ä¾èµ–)
    â””â”€ Phase 2: AvatarManager(å¯é€‰,è·å–é…ç½®)

ä»»åŠ¡5.7: è¾“å‡ºæ‰©å±•
â”œâ”€ ä»»åŠ¡5.2: Inputæ‰©å±•(é—´æ¥ä¾èµ–)
â””â”€ ä»»åŠ¡5.6: è¾“å‡ºæ‰©å±•(é—´æ¥ä¾èµ–)
    â””â”€ Phase 4: Expression/Renderingå±‚
```

---

## ğŸš€ å®æ–½é¡ºåº

### ä¸²è¡Œæ‰§è¡Œ(å¿…é¡»éµå®ˆ)

1. Extensionæ¥å£å’ŒManager
   - æ‰€æœ‰æ‰©å±•ä¾èµ–æ­¤æ¥å£

2. æ‰©å±•Managerå®ç°
   - ç®¡ç†æ‰€æœ‰æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸ

3. å„ä¸ªæ‰©å±•è¿ç§»(å¯å¹¶è¡Œ,ä½†éœ€è¦é€ä¸ªéªŒè¯)
   - æ¸¸æˆæ‰©å±•: maicraft, mainosaba, arknights, warudo
   - è¾“å…¥æ‰©å±•: bili_danmakuç³»åˆ—, funasr_stt
   - è¾“å‡ºæ‰©å±•: tts, subtitle, sticker, vts, omni_tts

4. å¤„ç†å‹æ‰©å±•
   - ç”±äºæœåŠ¡ä¾èµ–å¤æ‚,å»ºè®®é€ä¸ªè¿ç§»éªŒè¯

### å…³é”®è·¯å¾„

**Phase 3: DecisionProvider â†’ Phase 4: Layer 5: Expression**:
```
DecisionProvider.decide(canonical_message)
    â†“
emit("decision.response.generated", MessageBase)
    â†“
Layer 4: Understanding.parse(message_base)
    â†“
emit("understanding.intent.generated", Intent)
    â†“
Layer 5: ExpressionGenerator.generate(intent)
    â†“
emit("expression.parameters_generated", RenderParameters)
```

**Layer 5: Expression â†’ Layer 6: Rendering**:
```
emit("expression.parameters_generated", RenderParameters)
    â†“
OutputProviderManager.render_all(RenderParameters)
    â†“
å„ä¸ªExtension.render(RenderParameters)
```

---

## âš ï¸ é£é™©æ§åˆ¶

### é£é™©1: æ’ä»¶ä¾èµ–é“¾å¤æ‚
- **æ¦‚ç‡**: é«˜
- **å½±å“**: å¾ªç¯ä¾èµ–å¯¼è‡´å¯åŠ¨å›°éš¾
- **ç¼“è§£**:
  - 1. ExtensionManagerå®ç°ä¾èµ–æ£€æµ‹(æ£€æŸ¥å¾ªç¯ä¾èµ–)
  - 2. æ·»åŠ å¯åŠ¨è¶…æ—¶æœºåˆ¶
  - 3. æä¾›å¯åŠ¨é¡ºåºé…ç½®

### é£é™©2: æœåŠ¡æ³¨å†Œå’ŒEventBusæ··ç”¨
- **æ¦‚ç‡**: ä¸­
- **å½±å“**: é€šä¿¡æ–¹å¼ä¸ä¸€è‡´å¯¼è‡´æ··ä¹±
- **ç¼“è§£**:
  - 1. æ˜ç¡®è§„èŒƒ: æœåŠ¡æ³¨å†Œç”¨äºå†å²å…¼å®¹,EventBusç”¨äºæ–°æ¶æ„
  - 2. æä¾›è¿ç§»å·¥å…·å‡½æ•°è‡ªåŠ¨è½¬æ¢
  - 3. é˜¶æ®µæ€§ç§»é™¤æœåŠ¡æ³¨å†Œ

### é£é™©3: æ¸¸æˆæ‰©å±•ç½‘ç»œè¿æ¥ç¨³å®šæ€§
- **æ¦‚ç‡**: ä¸­
- **å½±å“**: ç½‘ç»œé—®é¢˜å¯èƒ½å¯¼è‡´æ¸¸æˆè¿æ¥ä¸­æ–­
- **ç¼“è§£**:
  - 1. æ·»åŠ é‡è¿æœºåˆ¶(æ–­å¼€é‡è¿)
  - 2. å¿ƒè·³æ£€æµ‹
  - 3. é”™è¯¯æ¢å¤ç­–ç•¥

### é£é™©4: å¤§é‡æ’ä»¶è¿ç§»çš„å·¥ä½œé‡
- **æ¦‚ç‡**: ä¸­
- **å½±å“**: 53-73å¤©çš„æ’ä»¶è¿ç§»,å®¹æ˜“å‡ºé”™æˆ–é—æ¼åŠŸèƒ½
- **ç¼“è§£**:
  - 1. ä¸¥æ ¼æŒ‰ç…§è¿ç§»ä¼˜å…ˆçº§
  - 2. æ¯ä¸ªæ’ä»¶è¿ç§»åç«‹å³æµ‹è¯•éªŒè¯
  - 3. ä¿ç•™æ—§æ’ä»¶ä»£ç ä½œä¸ºå‚è€ƒ,ç›´åˆ°ç¡®è®¤æ–°Extensionæ­£å¸¸å·¥ä½œ
  - 4. æä¾›å›é€€æœºåˆ¶(é…ç½®ç¦ç”¨æ—§æ’ä»¶)

### é£é™©5: æ’ä»¶é…ç½®å…¼å®¹æ€§ä¿è¯
- **æ¦‚ç‡**: é«˜
- **å½±å“**: 23ä¸ªæ’ä»¶çš„é…ç½®è½¬æ¢å¯èƒ½å‡ºé”™
- **ç¼“è§£**:
  - 1. è‡ªåŠ¨è½¬æ¢å·¥å…·å¹¶éªŒè¯
  - 2. æä¾›é…ç½®éªŒè¯å™¨
  - 3. ä¿ç•™æ—§é…ç½®ä½œä¸ºå¤‡ä»½
  - 4. æ‰‹åŠ¨ç¡®è®¤åå†åˆ é™¤

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰23ä¸ªæ’ä»¶æ­£ç¡®è¿ç§»åˆ°Extension
- [ ] è¾“å…¥å’Œè¾“å‡ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ¸¸æˆäº¤äº’åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å¤„ç†å‹åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†å®Œå–„,å•ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–

### æ€§èƒ½éªŒæ”¶
- [ ] å¯åŠ¨æ—¶é—´<30s(æ‰€æœ‰Extension)
- [ ] å†…å­˜ä½¿ç”¨æ— æ˜æ˜¾å¢åŠ 
- [ ] å¹¶å‘ä»»åŠ¡æ— æ€§èƒ½é—®é¢˜

### å…¼å®¹æ€§éªŒæ”¶
- [ ] æ—§é…ç½®è‡ªåŠ¨è½¬æ¢ä¸ºæ–°æ ¼å¼
- [ ] æ–°é…ç½®æ ¼å¼æ¸…æ™°ç®€å•
- [ ] æœåŠ¡æ³¨å†Œå…¼å®¹(é€šè¿‡EventBus)
- [ ] é™çº§æœºåˆ¶ç”Ÿæ•ˆ

### ç¨³å®šæ€§éªŒæ”¶
- [ ] æ‰€æœ‰Extensionå¯ç‹¬ç«‹å¯åœ
- [ ] é•¿æ—¶é—´è¿è¡Œæ— å†…å­˜æ³„æ¼
- [ ] é”™è¯¯å¤„ç†å®Œå–„,æ— æœªæ•è·çš„å¼‚å¸¸

### æ–‡æ¡£éªŒæ”¶
- [ ] Extensionæ¥å£æ–‡æ¡£æ¸…æ™°
- [ ] ExtensionManageræ–‡æ¡£å®Œæ•´
- [ ] å„ä¸ªExtensionè¿ç§»æŒ‡å—è¯¦ç»†
- [ ] é…ç½®è¿ç§»å·¥å…·æ–‡æ¡£é½å…¨
- [ ] å›é€€æœºåˆ¶è¯´æ˜

### ç¤¾åŒºå‹å¥½éªŒæ”¶
- [ ] ç¤¾åŒºå¼€å‘è€…å¯ä»¥è½»æ¾åˆ›å»ºæ–°æ‰©å±•
- [ ] æ‰©å±•åŠ è½½æœºåˆ¶ç®€å•(src/extensions/æˆ–extensions/)
- [ ] é…ç½®ç¤ºä¾‹æ¸…æ™°
- [ ] ç¤ºä¾‹Extensionä»£ç å®Œæ•´

---

## ğŸ—ºï¸ è¿ç§»æŒ‡å—

### ä»æ’ä»¶åˆ°Extensionçš„æ­¥éª¤

**1. åˆ†ææ—§æ’ä»¶**:
   - åˆ—å‡ºæ‰€æœ‰åŠŸèƒ½ç‚¹
   - è¯†åˆ«ç‹¬ç«‹åŠŸèƒ½
   - è¯†åˆ«æœåŠ¡ä¾èµ–å’ŒEventBusä½¿ç”¨

**2. è®¾è®¡Extensionç»“æ„**:
   - å°†æ’ä»¶æ‹†åˆ†ä¸ºExtension + å¤šä¸ªProvider
   - Extensionè´Ÿè´£é…ç½®ã€ç”Ÿå‘½å‘¨æœŸ
   - Providerè´Ÿè´£å…·ä½“å®ç°

**3. é€‚é…æ¥å£**:
   - å®ç°setup()æ–¹æ³•(è®¢é˜…äº‹ä»¶ã€æ³¨å†ŒæœåŠ¡é™çº§)
   - å®ç°cleanup()æ–¹æ³•(æ¸…ç†èµ„æº)
   - è¿”å›Provideråˆ—è¡¨

**4. å¤„ç†æœåŠ¡ä¾èµ–**:
   - ä¿ç•™get_serviceè°ƒç”¨(é™çº§æ–¹æ¡ˆ)
   - é€æ­¥æ›¿æ¢ä¸ºEventBusè®¢é˜…
   - å¤„ç†æœåŠ¡ä¸å­˜åœ¨çš„æƒ…å†µ

**5. è¿ç§»æµ‹è¯•**:
   - å¯¹æ¯”æ–°æ—§ExtensionåŠŸèƒ½
   - ç¡®ä¿æ²¡æœ‰é—æ¼
   - æµ‹è¯•è¾¹ç¼˜æƒ…å†µ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Phase 1: åŸºç¡€è®¾æ–½](./phase1_infrastructure.md)
- [Phase 2: è¾“å…¥å±‚](./phase2_input.md)
- [Phase 3: å†³ç­–å±‚+ä¸­é—´å±‚](./phase3_decision.md)
- [Phase 4: è¾“å‡ºå±‚](./phase4_output.md)
- [6å±‚æ¶æ„è®¾è®¡](../design/layer_refactoring.md)
- [æ’ä»¶ç³»ç»Ÿè®¾è®¡](../design/plugin_system.md)
