# Maicraft 弹幕互动游戏插件

## 概述

Maicraft 是一个弹幕互动游戏插件，能够接收来自弹幕的"/"前缀命令，通过行动抽象层控制游戏角色。

## 功能特性

- **命令解析**: 支持解析 `/command args` 格式的命令
- **行动抽象**: 每个行动都有独立的类实现，便于扩展
- **多种实现**: 支持不同的执行器实现（日志、真实游戏等）
- **命令别名**: 支持多个命令映射到同一个行动

## 支持的命令

### 聊天命令
- `/chat <message>` - 发送聊天消息
- `/say <message>` - 发送聊天消息（别名）
- `/whisper <message>` - 发送聊天消息（别名）

## 配置

插件配置位于 `config.toml` 文件中：

```toml
# 是否启用插件
enabled = true

# 行动执行器类型 (log/minecraft)
executor_type = "log"

# 命令到行动的映射配置
# 格式：命令名 = "动作标识"
# 动作标识由具体的动作类定义（如 ChatAction 的动作标识为 "chat_action"）
[command_mappings]
chat = "chat_action"
say = "chat_action"      # 多个命令可以映射到同一个行动
whisper = "chat_action"
```

## 使用方法

1. 确保在主配置文件中启用了 `cmd_router` 管道和 `maicraft` 插件
2. 通过弹幕或控制台发送命令，如：`/chat 你好世界`
3. 查看日志输出确认命令执行

## 扩展开发

### 添加新的行动

1. 在 `actions/` 目录下创建新的行动类，继承 `BaseAction`
2. 实现 `execute()` 和 `get_action_id()` 方法
3. 在配置文件中添加命令映射（系统会自动发现新的行动类）

**注意**: 行动类会通过 `ActionDiscoverer` 自动发现，无需手动注册。

### 添加新的执行器

1. 在 `impl/` 目录下创建新的执行器类，继承 `ActionExecutor`
2. 实现 `execute_action()` 方法
3. 在插件主文件中添加执行器类型判断逻辑

## 架构设计

```
弹幕消息 -> cmd_router管道 -> maicraft插件 -> 命令解析器 -> 行动注册表 -> 具体行动类 -> 执行器实现
```

- **cmd_router管道**: 拦截包含"/"前缀的消息，转发给订阅插件
- **命令解析器**: 解析命令格式和参数
- **行动注册表**: 管理命令到行动类的映射
- **行动类**: 具体的行动实现，每个行动都有独立的类
- **执行器**: 不同的实现方式，如日志输出、真实游戏控制等
