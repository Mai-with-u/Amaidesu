# Amaidesu æ¶æ„é‡æ„è®¡åˆ’ï¼šåŸºäºAI VTuberåŠŸèƒ½åŸŸçš„æ¨¡å—åŒ–è®¾è®¡

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬è®¡åˆ’æ—¨åœ¨é€šè¿‡**æŒ‰AI VTuberåŠŸèƒ½åŸŸé‡æ–°ç»„ç»‡æ¶æ„**ï¼Œè§£å†³å½“å‰amaidesué¡¹ç›®å­˜åœ¨çš„"ç»´æŠ¤éš¾"ã€"è¿‡åº¦æ’ä»¶åŒ–"ã€"é…ç½®å¤æ‚"ç­‰é—®é¢˜ã€‚

### æ ¸å¿ƒæ”¹è¿›

1. **æŒ‰åŠŸèƒ½åŸŸç»„ç»‡æ¨¡å—**ï¼šéŸ³è¾“å…¥â†’è¯­è¨€æ¨ç†â†’è¡¨æƒ…åŠ¨ä½œâ†’è™šæ‹Ÿæ¸²æŸ“â†’ç›´æ’­æ¨æµ
2. **å¯æ›¿æ¢å®ç°æœºåˆ¶**ï¼šæ¯ä¸ªæ¨¡å—å†…éƒ¨æ”¯æŒå¤šç§å®ç°æ–¹å¼
3. **è§£å†³ä¾èµ–åœ°ç‹±**ï¼šé€šè¿‡å•å‘æ•°æ®æµå’Œæ¥å£é€šä¿¡æ¶ˆé™¤å¾ªç¯ä¾èµ–
4. **ç®€åŒ–é…ç½®ç³»ç»Ÿ**ï¼šåˆ†å±‚é…ç½®ï¼Œé™ä½è®¤çŸ¥è´Ÿæ‹…
5. **é‡æ–°å®šä½æ’ä»¶ç³»ç»Ÿ**ï¼šä»…ç”¨äºå¹³å°/æ¸¸æˆé›†æˆï¼Œæ ¸å¿ƒåŠŸèƒ½æ¨¡å—åŒ–

### è®¾è®¡åŸåˆ™

- **åŠŸèƒ½åŸŸé©±åŠ¨**ï¼šæŒ‰AI VTuberå·¥ä½œæµç¨‹ç»„ç»‡ï¼Œè€ŒéæŠ€æœ¯æ¨¡å¼
- **å•å‘æ•°æ®æµ**ï¼šæ¨¡å—é—´æŒ‰ä¸šåŠ¡æµç¨‹å•å‘é€šä¿¡ï¼Œæ— å¾ªç¯ä¾èµ–
- **æ¥å£ç»Ÿä¸€**ï¼šåŒç±»åŠŸèƒ½æ”¶æ•›åˆ°ä¸€ä¸ªæ¥å£ï¼Œå®ç°å¯æ›¿æ¢
- **æ¸è¿›å¼è¿ç§»**ï¼šå‘åå…¼å®¹ï¼Œå¹³æ»‘è¿‡æ¸¡
- **å®ç”¨ä¸»ä¹‰**ï¼šä¿ç•™æœ‰ä»·å€¼çš„æ’ä»¶ï¼Œç§»é™¤å†—ä½™

---

## ğŸ¯ é—®é¢˜éªŒè¯ï¼ˆåŸºäºä»£ç åˆ†æï¼‰

### å½“å‰æ¶æ„çš„æ ¸å¿ƒé—®é¢˜

#### 1. "è‡ªæˆ‘æŠ˜ç£¨"çš„é…ç½®åˆ‡æ¢
**ç°çŠ¶**ï¼šTTSåŠŸèƒ½æœ‰3ä¸ªç‹¬ç«‹æ’ä»¶ï¼Œé€šè¿‡é…ç½®åˆ‡æ¢
```
src/plugins/tts/           # Edge TTS
src/plugins/gptsovits_tts/ # GPT-SoVITS
src/plugins/omni_tts/      # Omni TTS
```

**é—®é¢˜**ï¼š
- ä»£ç å†—ä½™ï¼Œä¸‰ä¸ªæ’ä»¶é‡å¤ä¾èµ–ç›¸åŒæœåŠ¡
- åˆ‡æ¢å®ç°éœ€è¦ä¿®æ”¹`[plugins] enabled = [...]`åˆ—è¡¨
- é…ç½®åˆ†æ•£åœ¨å¤šä¸ªåœ°æ–¹

#### 2. "ä¼ªæ’ä»¶"é—®é¢˜
**ç°çŠ¶**ï¼šconsole_inputã€keyword_actionå®é™…æ— æ³•ç¦ç”¨
**é—®é¢˜**ï¼šä¸ç¬¦åˆ"æ’ä»¶=å¯æ‹”æ’"çš„è¯­ä¹‰

#### 3. åŠŸèƒ½åˆ†ç±»ä¸æ¸…
**ç°çŠ¶**ï¼š20+ä¸ªæ’ä»¶æ··åœ¨ä¸€èµ·ï¼Œæ–°å¼€å‘è€…éš¾ä»¥ç†è§£
**é—®é¢˜**ï¼šç¼ºä¹æ¸…æ™°çš„åŠŸèƒ½åŸŸåˆ’åˆ†

#### 4. æ’ä»¶ç³»ç»Ÿå®šä½æ¨¡ç³Š
**ç°çŠ¶**ï¼šæ ¸å¿ƒåŠŸèƒ½ã€å¯é€‰æ‰©å±•ã€æµ‹è¯•å·¥å…·éƒ½ä½œä¸ºæ’ä»¶
**é—®é¢˜**ï¼šæ’ä»¶ç³»ç»Ÿæ‰¿è½½äº†è¿‡å¤šèŒè´£

#### 5. ä¾èµ–åœ°ç‹±ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰
**ç°çŠ¶**ï¼š24ä¸ªæ’ä»¶ä¸­æœ‰18ä¸ªä½¿ç”¨æœåŠ¡æ³¨å†Œï¼Œæ’ä»¶é—´äº’ç›¸ä¾èµ–
```python
# ä¾èµ–é“¾ç¤ºä¾‹
vts_control_service = self.core.get_service("vts_control")
cleanup_service = self.core.get_service("text_cleanup")
subtitle_service = self.core.get_service("subtitle_service")
```
**é—®é¢˜**ï¼š
- å¯åŠ¨é¡ºåºä¾èµ–ï¼ˆå¿…é¡»å…ˆå¯åŠ¨è¢«ä¾èµ–çš„æœåŠ¡ï¼‰
- "æ’ä»¶æ’åˆ—ç»„åˆ"è°ƒè¯•å›°éš¾ï¼ˆtc_é­”æ³•å£«çš„è¯Ÿç—…ï¼‰
- é…ç½®é”™è¯¯å¯¼è‡´å¯åŠ¨å¤±è´¥
- éš¾ä»¥å•ç‹¬æµ‹è¯•æ’ä»¶

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡ï¼šåŸºäºAI VTuberåŠŸèƒ½åŸŸ

### æ ¸å¿ƒç†å¿µ

**ä¸æŒ‰æŠ€æœ¯æ¨¡å¼ï¼ˆ"ç­–ç•¥"ã€"å·¥å‚"ï¼‰ç»„ç»‡ç›®å½•ï¼Œè€Œæ˜¯æŒ‰AI VTuberçš„å·¥ä½œæµç¨‹ç»„ç»‡æ¨¡å—ã€‚**

æ¯ä¸ªæ¨¡å—å†…éƒ¨å¦‚æœæœ‰å¤šç§å®ç°æ–¹å¼ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼ç­‰æŠ€æœ¯æ‰‹æ®µï¼Œä½†è¿™ä¸ä½“ç°åœ¨ç›®å½•å‘½åä¸Šã€‚

### AI VTuberäº”å±‚æ¶æ„

```mermaid
graph TB
    subgraph "éŸ³è¾“å…¥å±‚"
        AudioIn[éº¦å…‹é£ / éŸ³é¢‘æµ / å¼¹å¹• / æ§åˆ¶å°]
    end

    subgraph "è¯­è¨€æ¨ç†å±‚"
        LangProc[LLM / STT / NLP / ä¸Šä¸‹æ–‡ç®¡ç†]
    end

    subgraph "è¡¨æƒ…åŠ¨ä½œå±‚"
        ExprGen[æƒ…æ„Ÿåˆ†æ / åŠ¨ä½œæ˜ å°„ / è§¦å‘é€»è¾‘]
    end

    subgraph "è™šæ‹Ÿæ¸²æŸ“å±‚"
        VirtRend[Live2D / VRM / Unity / VTS / Warudo]
    end

    subgraph "ç›´æ’­æ¨æµå±‚"
        Stream[OBS / å¹³å°æ¨æµ]
    end

    AudioIn -->|éŸ³é¢‘/æ–‡æœ¬è¾“å…¥| LangProc
    LangProc -->|æ–‡æœ¬ç†è§£| ExprGen
    ExprGen -->|è¡¨æƒ…å‚æ•°| VirtRend
    VirtRend -->|æ¸²æŸ“å‚æ•°| Stream

    style AudioIn fill:#e1f5ff,stroke:#333,stroke-width:2px
    style LangProc fill:#fff4e1,stroke:#333,stroke-width:2px
    style ExprGen fill:#ffe1f5,stroke:#333,stroke-width:2px
    style VirtRend fill:#e1ffe1,stroke:#333,stroke-width:2px
    style Stream fill:#f5e1ff,stroke:#333,stroke-width:2px
```

### ç›®å½•ç»“æ„è®¾è®¡

```
amaidesu/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                              # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ amaidesu_core.py               # ä¸­å¤®æ¢çº½
â”‚   â”‚   â”œâ”€â”€ event_bus.py                   # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ pipeline_manager.py            # ç®¡é“ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ context_manager.py             # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ module_loader.py               # ã€æ–°å¢ã€‘æ¨¡å—åŠ è½½å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ audio_input/                       # ã€åŠŸèƒ½åŸŸã€‘éŸ³é¢‘è¾“å…¥
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_microphone.py             # éº¦å…‹é£è¾“å…¥æ¥å£
â”‚   â”‚   â”œâ”€â”€ implementations/               # å®ç°ç›®å½•ï¼ˆä¸ä½“ç°åœ¨APIï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ default_microphone.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stream_audio.py
â”‚   â”‚   â”‚   â””â”€â”€ device_manager.py
â”‚   â”‚   â””â”€â”€ text_input/                    # æ–‡æœ¬è¾“å…¥ä¹Ÿå½’äºæ­¤åŸŸ
â”‚   â”‚       â”œâ”€â”€ console_input.py           # æ§åˆ¶å°è¾“å…¥
â”‚   â”‚       â””â”€â”€ danmaku_receiver.py        # å¼¹å¹•æ¥æ”¶
â”‚   â”‚
â”‚   â”œâ”€â”€ language_processing/               # ã€åŠŸèƒ½åŸŸã€‘è¯­è¨€å¤„ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_stt.py                    # è¯­éŸ³è¯†åˆ«æ¥å£
â”‚   â”‚   â”œâ”€â”€ base_llm.py                    # LLMæ¥å£
â”‚   â”‚   â”œâ”€â”€ implementations/
â”‚   â”‚   â”‚   â”œâ”€â”€ edge_stt.py
â”‚   â”‚   â”‚   â”œâ”€â”€ funasr_stt.py
â”‚   â”‚   â”‚   â””â”€â”€ openai_llm.py
â”‚   â”‚   â””â”€â”€ context_manager.py             # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ expression_generation/             # ã€åŠŸèƒ½åŸŸã€‘è¡¨æƒ…ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ emotion_analyzer.py            # æƒ…æ„Ÿåˆ†æ
â”‚   â”‚   â”œâ”€â”€ action_mapper.py               # åŠ¨ä½œæ˜ å°„
â”‚   â”‚   â””â”€â”€ trigger_engine.py              # è§¦å‘å¼•æ“
â”‚   â”‚
â”‚   â”œâ”€â”€ virtual_rendering/                 # ã€åŠŸèƒ½åŸŸã€‘è™šæ‹Ÿæ¸²æŸ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_renderer.py              # æ¸²æŸ“å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ implementations/
â”‚   â”‚   â”‚   â”œâ”€â”€ vts_renderer.py            # VTSé€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ warudo_renderer.py         # Warudoé€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ obs_renderer.py            # OBSé€‚é…å™¨
â”‚   â”‚   â”‚   â””â”€â”€ vrc_renderer.py            # VRChaté€‚é…å™¨
â”‚   â”‚   â””â”€â”€ avatar_manager.py              # è™šæ‹Ÿå½¢è±¡ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ audio_output/                      # ã€åŠŸèƒ½åŸŸã€‘éŸ³é¢‘è¾“å‡º
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_tts.py                    # TTSæ¥å£
â”‚   â”‚   â”œâ”€â”€ implementations/
â”‚   â”‚   â”‚   â”œâ”€â”€ edge_tts.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gptsovits_tts.py
â”‚   â”‚   â”‚   â””â”€â”€ omni_tts.py
â”‚   â”‚   â””â”€â”€ playback_manager.py            # æ’­æ”¾ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ visual_output/                     # ã€åŠŸèƒ½åŸŸã€‘è§†è§‰è¾“å‡º
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ subtitle_renderer.py           # å­—å¹•æ¸²æŸ“
â”‚   â”‚   â””â”€â”€ sticker_renderer.py            # è´´çº¸æ¸²æŸ“
â”‚   â”‚
â”‚   â””â”€â”€ streaming/                         # ã€åŠŸèƒ½åŸŸã€‘ç›´æ’­æ¨æµ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ obs_streamer.py                # OBSæ¨æµ
â”‚       â””â”€â”€ platform_streamer.py           # å¹³å°æ¨æµ
â”‚
â”œâ”€â”€ plugins/                              # ã€ä¿ç•™ã€‘æ’ä»¶ç³»ç»Ÿï¼ˆé‡æ–°å®šä½ï¼‰
â”‚   â”œâ”€â”€ internal/                          # å†…ç½®æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ game_integration/              # æ¸¸æˆé›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ mainosaba/                 # é­”è£æ¸¸æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ arknights/                 # æ˜æ—¥æ–¹èˆŸ
â”‚   â”‚   â”‚   â””â”€â”€ minecraft/                 # æˆ‘çš„ä¸–ç•Œ
â”‚   â”‚   â”œâ”€â”€ platform_integration/          # å¹³å°é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ bili_danmaku/              # Bç«™å¼¹å¹•
â”‚   â”‚   â”‚   â””â”€â”€ dg_lab_service/            # DG-LABæœåŠ¡
â”‚   â”‚   â””â”€â”€ tools/                         # å·¥å…·æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ screen_monitor.py          # å±å¹•ç›‘æ§
â”‚   â”‚       â””â”€â”€ message_replayer.py        # æ¶ˆæ¯é‡æ”¾
â”‚   â”‚
â”‚   â””â”€â”€ external/                          # å¤–éƒ¨æ’ä»¶ï¼ˆç”¨æˆ·è‡ªå†™ï¼‰
â”‚       â”œâ”€â”€ .gitkeep
â”‚       â””â”€â”€ README.md
â”‚
â”œâ”€â”€ config-template.toml
â””â”€â”€ main.py
```

### æ¶æ„è®¾è®¡è¦ç‚¹

1. **åŠŸèƒ½åŸŸä½œä¸ºé¡¶çº§ç»„ç»‡**ï¼šaudio_input, language_processingç­‰æŒ‰ä¸šåŠ¡åŠŸèƒ½å‘½å
2. **å®ç°ç»†èŠ‚éšè—**ï¼šæ¯ä¸ªåŠŸèƒ½åŸŸä¸‹çš„`implementations/`ç›®å½•å­˜æ”¾å…·ä½“å®ç°
3. **æ¥å£ç»Ÿä¸€**ï¼šæ¯ä¸ªåŠŸèƒ½åŸŸå®šä¹‰æ¸…æ™°çš„æ¥å£ï¼ˆbase_xxx.pyï¼‰
4. **å•å‘æ•°æ®æµ**ï¼šæ¨¡å—é—´æŒ‰ä¸šåŠ¡æµç¨‹å•å‘é€šä¿¡ï¼Œæ¶ˆé™¤å¾ªç¯ä¾èµ–

---

## ğŸ”„ ä¾èµ–åœ°ç‹±é—®é¢˜è§£å†³æ–¹æ¡ˆ

### å½“å‰ä¾èµ–é—®é¢˜åˆ†æ

åŸºäºä»£ç åˆ†æï¼Œå½“å‰é¡¹ç›®å­˜åœ¨ä¸¥é‡çš„ä¾èµ–é—®é¢˜ï¼š

#### é—®é¢˜1ï¼šæœåŠ¡æ³¨å†Œå¯¼è‡´çš„å¼ºè€¦åˆ

```python
# å½“å‰ä»£ç ä¸­çš„ä¾èµ–é“¾
TTSPlugin:
    - ä¾èµ– text_cleanup_service
    - ä¾èµ– subtitle_service
    - ä¾èµ– vts_lip_sync_service

VTSPlugin:
    - æ³¨å†Œ vts_control_service
    - æ³¨å†Œ vts_lip_sync_service

SubtitlePlugin:
    - ä¾èµ– tts_serviceï¼ˆè·å–éŸ³é¢‘æ—¶é•¿ï¼‰
```

**é—®é¢˜**ï¼š
- å¯åŠ¨é¡ºåºå¿…é¡»æ»¡è¶³ï¼šVTS â†’ TTS â†’ Subtitle
- å¦‚æœç¦ç”¨æŸä¸ªä¸­é—´æ’ä»¶ï¼Œæ•´ä¸ªä¾èµ–é“¾æ–­è£‚
- æ–°å¢æ’ä»¶æ—¶éš¾ä»¥ç†è§£å¤æ‚çš„ä¾èµ–å…³ç³»

#### é—®é¢˜2ï¼šåŒå‘ä¾èµ–

```python
# Avatarç³»ç»Ÿä¾èµ–TTS
AvatarControlManager:
    - è°ƒç”¨TTSè·å–è¯­éŸ³æ—¶é•¿
    - è§¦å‘å£å‹åŒæ­¥

# TTSä¾èµ–Avatarç³»ç»Ÿ
TTSPlugin:
    - é€šçŸ¥Avataræ›´æ–°è¡¨æƒ…
    - æ³¨å†Œvts_lip_sync_service
```

**é—®é¢˜**ï¼šå¾ªç¯ä¾èµ–å¯¼è‡´æ¨¡å—éš¾ä»¥ç‹¬ç«‹æµ‹è¯•å’Œå¤ç”¨

### è§£å†³æ–¹æ¡ˆæ¶æ„

#### æ ¸å¿ƒæ€è·¯ï¼šå•å‘æ•°æ®æµ + äº‹ä»¶é©±åŠ¨

```mermaid
graph LR
    subgraph "æ— ä¾èµ–çš„æ•°æ®æµ"
        Input[éŸ³è¾“å…¥æ¨¡å—] --> STX[è¯­è¨€å¤„ç†æ¨¡å—]
        STX --> Expr[è¡¨æƒ…ç”Ÿæˆæ¨¡å—]
        Expr --> Render[è™šæ‹Ÿæ¸²æŸ“æ¨¡å—]
        STX --> TTS[éŸ³é¢‘è¾“å‡ºæ¨¡å—]
        TTS --> Stream[ç›´æ’­æ¨æµæ¨¡å—]
    end

    subgraph "äº‹ä»¶æ€»çº¿ï¼ˆè§£è€¦é€šä¿¡ï¼‰"
        EventBus((EventBus))
        Input -.è®¢é˜….-> EventBus
        Render -.è§¦å‘.-> EventBus
        TTS -.å‘å¸ƒ.-> EventBus
    end

    style EventBus fill:#f96,stroke:#333,stroke-width:3px
```

#### æ–¹æ¡ˆ1ï¼šåŠŸèƒ½åŸŸé—´å•å‘ä¾èµ–

**åŸåˆ™**ï¼šæŒ‰AI VTuberä¸šåŠ¡æµç¨‹ç»„ç»‡ï¼Œä¸Šæ¸¸ä¸ä¾èµ–ä¸‹æ¸¸

| åŠŸèƒ½åŸŸ | ä¾èµ– | è¢«ä¾èµ– |
|--------|------|--------|
| audio_input | æ—  | language_processing |
| language_processing | audio_input | expression_generation, audio_output |
| expression_generation | language_processing | virtual_rendering |
| virtual_rendering | expression_generation | streaming |
| audio_output | language_processing | streaming |
| visual_output | language_processing | streaming |
| streaming | æ‰€æœ‰è¾“å‡ºæ¨¡å— | æ—  |

**å®ç°**ï¼š
```python
# æ­£ç¡®çš„ä¾èµ–å…³ç³»
class LanguageProcessing:
    def __init__(self, audio_input: AudioInput):
        # âœ“ ä¸Šæ¸¸ä¾èµ–ä¸‹æ¸¸ï¼ˆæ­£å¸¸ï¼‰
        self.audio_source = audio_input

class ExpressionGeneration:
    def __init__(self, llm_client: LLMClient):
        # âœ“ åªä¾èµ–è¯­è¨€å¤„ç†çš„æ¥å£
        self.llm = llm_client

# é”™è¯¯çš„ä¾èµ–å…³ç³»ï¼ˆç¦æ­¢ï¼‰
class AudioOutput:
    def __init__(self, virtual_rendering: VirtualRendering):
        # âœ— ä¸‹æ¸¸ä¾èµ–ä¸Šæ¸¸ï¼ˆç¦æ­¢ï¼ï¼‰
        # è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨äº‹ä»¶ç³»ç»Ÿ
```

#### æ–¹æ¡ˆ2ï¼šäº‹ä»¶ç³»ç»Ÿè§£è€¦

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦åå‘é€šä¿¡æˆ–è·¨æ¨¡å—é€šçŸ¥

```python
# åœºæ™¯ï¼šTTSæ’­æ”¾å®Œæˆé€šçŸ¥Avataræ›´æ–°å£å‹

# âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥ä¾èµ–ï¼ˆå½“å‰ä»£ç ï¼‰
class TTSPlugin:
    def __init__(self, core):
        # ç›´æ¥è·å–AvataræœåŠ¡ï¼Œå½¢æˆä¾èµ–
        self.avatar = core.get_service("vts_lip_sync")

    async def play_audio(self, text):
        audio = await self.synthesize(text)
        await self.avatar.sync_lip_sync(audio)  # å¼ºè€¦åˆ

# âœ“ æ­£ç¡®åšæ³•ï¼šäº‹ä»¶é©±åŠ¨
class TTSModule:
    def __init__(self, core):
        # åªä¾èµ–äº‹ä»¶æ€»çº¿ï¼Œä¸ä¾èµ–Avataræ¨¡å—
        self.event_bus = core.event_bus

    async def play_audio(self, text):
        audio = await self.synthesize(text)
        # å‘å¸ƒäº‹ä»¶ï¼Œè°å…³å¿ƒè°è®¢é˜…
        await self.event_bus.emit("audio.playback_started", {
            "text": text,
            "duration": audio.duration
        })

# Avataræ¨¡å—è®¢é˜…äº‹ä»¶
class VirtualRenderingModule:
    async def setup(self):
        self.event_bus.subscribe("audio.playback_started", self.on_audio_playback)

    async def on_audio_playback(self, data):
        # å¤„ç†å£å‹åŒæ­¥
        await self.sync_lip_sync(data["text"])
```

#### æ–¹æ¡ˆ3ï¼šå·¥å‚æ¨¡å¼ç®¡ç†å®ç°

**é—®é¢˜**ï¼šåˆ‡æ¢å®ç°æ—¶éœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç 

```python
# å½“å‰ä»£ç ï¼šæ‰‹åŠ¨ç®¡ç†ä¾èµ–
class TTSPlugin:
    def __init__(self, core):
        # å¯èƒ½å¤±è´¥çš„æœåŠ¡è·å–
        self.cleanup = core.get_service("subtitle_service")
        if not self.cleanup:
            raise RuntimeError("subtitle_serviceæœªå¯åŠ¨")

# æ–°æ–¹æ¡ˆï¼šå·¥å‚æ¨¡å¼
class TTSStrategyFactory:
    _implementations = {
        "edge": EdgeTTSStrategy,
        "gptsovits": GPTSoVITSStrategy,
    }

    @classmethod
    def create(cls, strategy_name: str, config: dict):
        strategy_class = cls._implementations[strategy_name]
        return strategy_class(config)

# ä½¿ç”¨
tts = TTSStrategyFactory.create("edge", config)
# æ— éœ€æ‰‹åŠ¨ç®¡ç†ä¾èµ–ï¼Œç­–ç•¥å†…éƒ¨è‡ªå·±å¤„ç†
```

### ä¾èµ–æ¶ˆé™¤æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | å½“å‰æ¶æ„ | æ–°æ¶æ„ |
|------|---------|--------|
| **å¯åŠ¨é¡ºåº** | éœ€è¦æŒ‰ä¾èµ–é¡ºåºå¯åŠ¨æ’ä»¶ | ä»»æ„é¡ºåºï¼Œæ¨¡å—æŒ‰éœ€åŠ è½½ |
| **ç¦ç”¨åŠŸèƒ½** | å¯èƒ½å¯¼è‡´ä¾èµ–é“¾æ–­è£‚ | ä¸å½±å“å…¶ä»–æ¨¡å— |
| **æ–°å¢å®ç°** | éœ€è¦ä¿®æ”¹å¤šä¸ªæ’ä»¶çš„ä¾èµ–ä»£ç  | ä»…éœ€æ³¨å†Œåˆ°å·¥å‚ |
| **æµ‹è¯•** | éœ€è¦mockæ‰€æœ‰ä¾èµ–æœåŠ¡ | å¯ç‹¬ç«‹æµ‹è¯• |
| **é…ç½®åˆ‡æ¢** | ä¿®æ”¹enabledåˆ—è¡¨ï¼Œé‡å¯ç”Ÿæ•ˆ | ä¿®æ”¹é…ç½®ï¼Œå³æ—¶åˆ‡æ¢ |

### å…·ä½“ä¾èµ–æ¶ˆé™¤æ¡ˆä¾‹

#### æ¡ˆä¾‹1ï¼šTTSä¸Avatarçš„ä¾èµ–

**å½“å‰ä»£ç **ï¼š
```python
# TTSä¾èµ–Avatar
TTSPlugin â†’ get_service("vts_lip_sync")

# Avatarä¹Ÿä¾èµ–TTSï¼ˆè·å–æ—¶é•¿ï¼‰
VTSPlugin â†’ get_service("subtitle_service") â†’ get_service("tts")
```

**æ–°æ¶æ„**ï¼š
```python
# TTSæ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
audio_output/
    â”œâ”€â”€ base_tts.py              # åªè´Ÿè´£åˆæˆ
    â””â”€â”€ implementations/
        â””â”€â”€ edge_tts.py

# Avataræ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
virtual_rendering/
    â””â”€â”€ implementations/
        â””â”€â”€ vts_renderer.py

# é€šè¿‡äº‹ä»¶é€šä¿¡
EventBus:
    - audio.playback_started (TTSå‘å¸ƒ)
    - audio.playback_finished (TTSå‘å¸ƒ)
    - å‚æ•°æ›´æ–° (Avatarè®¢é˜…audioäº‹ä»¶)
```

#### æ¡ˆä¾‹2ï¼šå¤šä¸ªTTSå®ç°çš„ç»Ÿä¸€

**å½“å‰ä»£ç **ï¼š
```python
# ä¸‰ä¸ªç‹¬ç«‹æ’ä»¶ï¼Œæ¯ä¸ªéƒ½è¦é…ç½®ä¾èµ–å…³ç³»
plugins/tts/config.toml:
    [dependencies]
    required = ["text_cleanup", "subtitle"]

plugins/gptsovits_tts/config.toml:
    [dependencies]
    required = ["text_cleanup", "subtitle"]

plugins/omni_tts/config.toml:
    [dependencies]
    required = ["text_cleanup", "subtitle"]
```

**æ–°æ¶æ„**ï¼š
```python
# ä¸€ä¸ªTTSæ¨¡å—ï¼Œå¤šä¸ªå®ç°
audio_output/
    â”œâ”€â”€ base_tts.py               # ç»Ÿä¸€æ¥å£
    â””â”€â”€ implementations/
        â”œâ”€â”€ edge_tts.py          # ç‹¬ç«‹å®ç°
        â”œâ”€â”€ gptsovits_tts.py      # ç‹¬ç«‹å®ç°
        â””â”€â”€ omni_tts.py          # ç‹¬ç«‹å®ç°

# é…ç½®
[audio_output.tts]
provider = "edge"  # åˆ‡æ¢å®ç°åªéœ€æ”¹è¿™é‡Œ

# ä¾èµ–å…³ç³»ç”±å·¥å‚ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
```

### ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ

#### 1. æ˜ç¡®ä¾èµ–æ–¹å‘

```python
# âœ“ å…è®¸çš„ä¾èµ–
class ExpressionGeneration:
    def __init__(self, llm_client: LLMClient):
        # ä¸Šæ¸¸ä¾èµ–ä¸‹æ¸¸æ¥å£
        pass

# âœ— ç¦æ­¢çš„ä¾èµ–
class LLMClient:
    def __init__(self, expression_gen: ExpressionGeneration):
        # ä¸‹æ¸¸ä¾èµ–ä¸Šæ¸¸ï¼ˆå¾ªç¯ä¾èµ–ï¼‰
        pass
```

#### 2. ä½¿ç”¨æ¥å£è€Œéå®ç°

```python
# âœ“ ä¾èµ–æ¥å£
class ExpressionGeneration:
    def __init__(self, llm: LanguageModelInterface):  # æ¥å£
        pass

# âœ— ä¾èµ–å…·ä½“å®ç°
class ExpressionGeneration:
    def __init__(self, llm: OpenAILLM):  # å…·ä½“å®ç°
        pass
```

#### 3. äº‹ä»¶ç³»ç»Ÿå¤„ç†åå‘é€šä¿¡

```python
# éœ€è¦åå‘é€šä¿¡æ—¶ï¼Œä½¿ç”¨äº‹ä»¶
class TTSModule:
    async def on_playback_start(self, audio_data):
        # å‘å¸ƒäº‹ä»¶
        await self.event_bus.emit("tts.playback", {
            "duration": audio_data.duration
        })

class VirtualRenderingModule:
    def setup(self):
        # è®¢é˜…äº‹ä»¶
        self.event_bus.subscribe("tts.playback", self.on_tts_playback)

    async def on_tts_playback(self, data):
        # å¤„ç†å£å‹åŒæ­¥
        await self.sync_lip_sync(data["duration"])
```

---

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿé‡æ–°å®šä½

### å½“å‰æ’ä»¶ä½¿ç”¨æƒ…å†µ

åŸºäºä»£ç åˆ†æï¼Œ24ä¸ªæ’ä»¶çš„åˆ†ç±»ï¼š

| æ’ä»¶ç±»å‹ | æ•°é‡ | ä¸¾ä¾‹ |
|---------|------|------|
| **æ ¸å¿ƒåŠŸèƒ½** | 6ä¸ª | tts, vtube_studio, llm_text_processor |
| **å¯æ›¿æ¢å®ç°** | 4ä¸ª | gptsovits_tts, omni_tts, funasr_stt |
| **å¹³å°é›†æˆ** | 5ä¸ª | bili_danmaku, obs_control, vrchat |
| **æ¸¸æˆé›†æˆ** | 3ä¸ª | mainosaba, arknights, minecraft |
| **å·¥å…·ç±»** | 3ä¸ª | screen_monitor, subtitle, sticker |
| **æµ‹è¯•ç±»** | 1ä¸ª | mock_danmaku |
| **å¾…ç¡®è®¤** | 2ä¸ª | read_pingmu, emotion_judge |

### ä¿ç•™æ’ä»¶ç³»ç»Ÿçš„ç†ç”±

#### âœ… æ”¯æŒä¿ç•™

1. **ç¤¾åŒºç”Ÿæ€**ï¼š
   - ç”¨æˆ·å¯ä»¥è´¡çŒ®ç‰¹å®šå¹³å°çš„é›†æˆï¼ˆå¦‚æ–°çš„ç›´æ’­å¹³å°ï¼‰
   - ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆï¼ˆå¦‚æ–°çš„AIæœåŠ¡ï¼‰

2. **å®šåˆ¶éœ€æ±‚**ï¼š
   - ä¸åŒç”¨æˆ·æœ‰ä¸åŒçš„æ¸¸æˆ/å¹³å°é›†æˆéœ€æ±‚
   - å®éªŒæ€§åŠŸèƒ½å¯ä»¥å…ˆä½œä¸ºæ‰©å±•æµ‹è¯•

3. **å‘åå…¼å®¹**ï¼š
   - ç°æœ‰çš„æ’ä»¶å¼€å‘è€…å’Œç”¨æˆ·ä¸éœ€è¦å®Œå…¨é‡å†™
   - æ¸è¿›å¼è¿ç§»æ›´å¹³æ»‘

#### âŒ åå¯¹ä¿ç•™

1. **ç»´æŠ¤è´Ÿæ‹…**ï¼š
   - éœ€è¦ç»´æŠ¤æ’ä»¶åŠ è½½å™¨ã€APIã€æ–‡æ¡£
   - æ’ä»¶å…¼å®¹æ€§é—®é¢˜

2. **ä½¿ç”¨ç‡ä¸é«˜**ï¼š
   - ç¤¾åŒºè´¡çŒ®çš„æ’ä»¶å¯èƒ½è¾ƒå°‘
   - å¤§éƒ¨åˆ†ç”¨æˆ·åªç”¨æ ¸å¿ƒåŠŸèƒ½

3. **å¢åŠ å¤æ‚åº¦**ï¼š
   - æ–°å¼€å‘è€…éœ€è¦ç†è§£æ¨¡å—ç³»ç»Ÿ+æ‰©å±•ç³»ç»Ÿ
   - é…ç½®æ›´å¤æ‚

### ğŸ’¡ å»ºè®®æ–¹æ¡ˆï¼šç²¾ç®€çš„æ‰©å±•ç³»ç»Ÿ

**ä¸ä¿ç•™å®Œæ•´çš„æ’ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªè½»é‡çº§çš„æ‰©å±•æœºåˆ¶ã€‚**

#### è®¾è®¡æ€è·¯

```python
# æ‰©å±•ç³»ç»Ÿæç®€è®¾è®¡
class ExtensionLoader:
    """è½»é‡çº§æ‰©å±•åŠ è½½å™¨"""

    async def load_extension(self, extension_path: str):
        """åŠ è½½æ‰©å±•ï¼ˆåªæä¾›åŸºç¡€é’©å­ï¼‰"""
        # 1. åŠ è½½Pythonæ¨¡å—
        # 2. è°ƒç”¨setup(core)æ³¨å†Œé’©å­
        # 3. ä¸æä¾›å¤æ‚çš„æœåŠ¡æ³¨å†Œ/äº‹ä»¶ç³»ç»Ÿ
```

#### æ‰©å±•èƒ½åŠ›é™åˆ¶

**æ‰©å±•åªèƒ½åšä»¥ä¸‹äº‹æƒ…**ï¼š
- è®¢é˜…äº‹ä»¶ï¼ˆevent_busï¼‰
- æ³¨å†ŒHTTPå›è°ƒè·¯ç”±
- æ³¨å†Œå‘½ä»¤å¤„ç†å™¨
- è®¿é—®æœ‰é™çš„å…¬å¼€API

**æ‰©å±•ä¸èƒ½åš**ï¼š
- ä¿®æ”¹æ ¸å¿ƒæ¨¡å—çš„è¡Œä¸º
- ç›´æ¥è®¿é—®æ¨¡å—å†…éƒ¨å®ç°
- æ³¨å†Œå¤æ‚çš„ä¾èµ–å…³ç³»

#### ä¸æ¨¡å—çš„åŒºåˆ«

| ç»´åº¦ | æ¨¡å— | æ‰©å±• |
|------|------|------|
| **ä½ç½®** | `src/{åŠŸèƒ½åŸŸ}/` | `extensions/` |
| **ç”¨é€”** | æ ¸å¿ƒåŠŸèƒ½ï¼Œç³»ç»Ÿå¿…éœ€ | å¯é€‰åŠŸèƒ½ï¼Œå¹³å°é›†æˆ |
| **APIè®¿é—®** | å®Œæ•´è®¿é—®å†…éƒ¨API | ä»…è®¿é—®å…¬å¼€API |
| **é…ç½®** | `config.toml`ä¸­æ˜¾å¼é…ç½® | è‡ªåŠ¨å‘ç°æˆ–æ‰‹åŠ¨å¯ç”¨ |
| **ç¤ºä¾‹** | audio_input, language_processing | bili_danmaku, game_integration |

### æœ€ç»ˆå»ºè®®

**ä¿ç•™ç²¾ç®€çš„æ‰©å±•ç³»ç»Ÿï¼Œä½†æ˜ç¡®å…¶å®šä½ï¼š**

1. **æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨æ¨¡å—åŒ–**ï¼š
   - audio_inputï¼ˆéº¦å…‹é£ã€æµéŸ³é¢‘ï¼‰
   - language_processingï¼ˆSTTã€LLMï¼‰
   - expression_generationï¼ˆæƒ…æ„Ÿåˆ†æã€åŠ¨ä½œæ˜ å°„ï¼‰
   - virtual_renderingï¼ˆVTSã€Warudoã€OBSï¼‰
   - audio_outputï¼ˆTTSï¼‰
   - visual_outputï¼ˆå­—å¹•ã€è´´çº¸ï¼‰

2. **æ‰©å±•ç³»ç»Ÿä»…ç”¨äº**ï¼š
   - å¹³å°é›†æˆï¼ˆBç«™ã€æŠ–éŸ³ç­‰ç›´æ’­å¹³å°ï¼‰
   - æ¸¸æˆé›†æˆï¼ˆç‰¹å®šçš„æ¸¸æˆåŠ©æ‰‹ï¼‰
   - ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆDG-LABç­‰ï¼‰
   - ç”¨æˆ·è‡ªå®šä¹‰å·¥å…·

3. **åºŸå¼ƒçš„æ’ä»¶**ï¼š
   - mock_danmakuï¼ˆæµ‹è¯•å·¥å…·ï¼Œåº”è¯¥æ”¾åœ¨tests/ï¼‰
   - åŠŸèƒ½é‡å¤çš„å®ç°ï¼ˆæ•´åˆåˆ°æ¨¡å—çš„implementations/ä¸­ï¼‰

---

## ğŸ”§ æ’ä»¶ç³»ç»Ÿæ”¹è¿›

### ç²¾ç®€çš„æ’ä»¶API

**æ’ä»¶èƒ½åŠ›é™åˆ¶**ï¼ˆé˜²æ­¢ä¾èµ–åœ°ç‹±ï¼‰ï¼š

```python
# âœ“ æ’ä»¶å¯ä»¥åšçš„äº‹
class DanmakuPlugin(BasePlugin):
    def setup(self, core):
        # 1. è®¢é˜…äº‹ä»¶
        core.event_bus.subscribe("message.received", self.on_message)

        # 2. æ³¨å†ŒHTTPè·¯ç”±
        core.http_server.register_route("/danmaku/callback", self.callback)

        3. è®¿é—®å…¬å¼€API
        core.api.tts.synthesize(text)  # é€šè¿‡ç»Ÿä¸€æ¥å£

# âœ— æ’ä»¶ä¸èƒ½åšçš„äº‹
class DanmakuPlugin(BasePlugin):
    def setup(self, core):
        # ä¸èƒ½ç›´æ¥è·å–æœåŠ¡ï¼ˆé˜²æ­¢ä¾èµ–ï¼‰
        # core.get_service("vts_control")  # âŒ

        # ä¸èƒ½ä¿®æ”¹æ ¸å¿ƒæ¨¡å—
        # core.module_loader.unload_module("audio_input")  # âŒ
```

### æ’ä»¶é…ç½®

```toml
[plugins]
# å†…ç½®æ’ä»¶
enabled_internal = [
    "bili_danmaku",
    "mainosaba",
]

# å¤–éƒ¨æ’ä»¶
enabled_external = [
    # "my_custom_plugin",
]

# æ’ä»¶ç‰¹å®šé…ç½®
[plugins.bili_danmaku]
room_id = 0
```

---

## ğŸ“¦ åŠŸèƒ½åŸŸè®¾è®¡è¯¦è§£

### åŠŸèƒ½åŸŸè¦†ç›–åº¦éªŒè¯

ç»è¿‡å¯¹æ‰€æœ‰24ä¸ªæ’ä»¶çš„å®Œæ•´åˆ†æï¼Œ**7ä¸ªåŠŸèƒ½åŸŸå®Œå…¨è¦†ç›–AI VTuberæ ¸å¿ƒå·¥ä½œæµç¨‹**ï¼š

| åŠŸèƒ½åŸŸ | æ ¸å¿ƒèŒè´£ | å¯¹åº”çš„ç°æœ‰æ’ä»¶ | è¦†ç›–åº¦ |
|--------|---------|---------------|--------|
| **audio_input** | éŸ³é¢‘/æ–‡æœ¬è¾“å…¥ | console_input | âœ… å®Œæ•´ |
| **language_processing** | è¯­éŸ³è¯†åˆ«ã€LLMå¤„ç† | stt, funasr_stt, llm_text_processor | âœ… å®Œæ•´ |
| **expression_generation** | æƒ…æ„Ÿåˆ†æã€åŠ¨ä½œè§¦å‘ | keyword_action, emotion_judge, avataræ§åˆ¶ç³»ç»Ÿ | âœ… å®Œæ•´ |
| **virtual_rendering** | è™šæ‹Ÿå½¢è±¡é©±åŠ¨ | vtube_studio, warudo, obs_control, vrchat | âœ… å®Œæ•´ |
| **audio_output** | è¯­éŸ³åˆæˆã€æ’­æ”¾ | tts, gptsovits_tts, omni_tts | âœ… å®Œæ•´ |
| **visual_output** | å­—å¹•ã€è´´çº¸æ¸²æŸ“ | subtitle, sticker | âœ… å®Œæ•´ |
| **streaming** | æ¨æµæ§åˆ¶ | obs_controlï¼ˆæ¨æµéƒ¨åˆ†ï¼‰ | âš ï¸ éœ€æ‰©å±• |

#### ç‰¹æ®ŠåŠŸèƒ½å¤„ç†

**ä¿ç•™ä¸ºæ’ä»¶çš„åŠŸèƒ½ï¼ˆä¸çº³å…¥åŠŸèƒ½åŸŸï¼‰**ï¼š
- **read_pingmu** - å±å¹•ç›‘æ§+VLæ¨¡å‹åˆ†æï¼Œç‰¹å®šçš„è§†è§‰è¾“å…¥æ–¹å¼ï¼Œä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éœ€è¦
- **remote_stream** - è¾¹ç¼˜è®¾å¤‡éŸ³è§†é¢‘æµï¼Œç‰¹å®šçš„éƒ¨ç½²åœºæ™¯
- **screen_monitor** - å¼€å‘è°ƒè¯•å·¥å…·
- **æ¸¸æˆé›†æˆ**ï¼ˆmainosaba, arknights, minecraft, maicraftï¼‰- ä¸å±äºAI VTuberæ ¸å¿ƒæµç¨‹
- **å¹³å°é›†æˆ**ï¼ˆbili_danmakuç³»åˆ—ï¼‰- ä¾èµ–äºç‰¹å®šå¹³å°API
- **ç¡¬ä»¶é›†æˆ**ï¼ˆdg_lab_serviceï¼‰- ä¾èµ–äºç‰¹å®šç¡¬ä»¶

#### åŠŸèƒ½æ•´åˆæ¡ˆä¾‹

**emotion_judge â†’ expression_generation**
- å½“å‰æ’ä»¶åŠŸèƒ½ï¼šLLMæƒ…æ„Ÿåˆ†æ + çƒ­é”®è§¦å‘
- æ•´åˆæ–¹æ¡ˆï¼šå°†æƒ…æ„Ÿåˆ†æèƒ½åŠ›èå…¥è¡¨æƒ…ç”ŸæˆåŸŸçš„æ™ºèƒ½è§¦å‘ç­–ç•¥
- ä¼˜åŠ¿ï¼šé¿å…åŠŸèƒ½é‡å¤ï¼Œç»Ÿä¸€æƒ…æ„Ÿå¤„ç†é€»è¾‘

### MaiBoté€šä¿¡æœºåˆ¶

**é‡è¦ç»“è®ºï¼šMaiBoté€šä¿¡æœºåˆ¶å®Œå…¨ä¸å˜**

åŠŸèƒ½åŸŸé‡æ„åªå½±å“**ä¸šåŠ¡é€»è¾‘å±‚**ï¼Œä¸æ¶‰åŠ**ä¼ è¾“å±‚**ï¼š

| é€šä¿¡ç»„ä»¶ | ä½œç”¨ | å˜åŒ– |
|---------|------|------|
| **WebSocket Router** (maim_message) | ä¸MaiCoreçš„WebSocketè¿æ¥ | âŒ æ— å˜åŒ– |
| **HTTP Server** | æ¥æ”¶MaiCoreçš„HTTPå›è°ƒ | âŒ æ— å˜åŒ– |
| **PipelineManager** | æ¶ˆæ¯é¢„å¤„ç†ï¼ˆå…¥ç«™/å‡ºç«™ç®¡é“ï¼‰ | âŒ æ— å˜åŒ– |
| **EventBus** | æ¨¡å—é—´äº‹ä»¶é€šä¿¡ | âŒ æ— å˜åŒ– |
| **ContextManager** | ä¸Šä¸‹æ–‡èšåˆç®¡ç† | âŒ æ— å˜åŒ– |

```mermaid
graph TB
    subgraph "ä¼ è¾“å±‚ï¼ˆä¸å˜ï¼‰"
        Router[WebSocket Router<br/>maim_message]
        HTTP[HTTP Server]
        Pipeline[PipelineManager]
    end

    subgraph "æ ¸å¿ƒå±‚ï¼ˆä¸å˜ï¼‰"
        Core[AmaidesuCore]
        EventBus[EventBus]
        Context[ContextManager]
    end

    subgraph "åŠŸèƒ½åŸŸå±‚ï¼ˆé‡æ„ç›®æ ‡ï¼‰"
        AudioIn[audio_input]
        LangProc[language_processing]
        ExprGen[expression_generation]
        VirtRend[virtual_rendering]
        AudioOut[audio_output]
        VisOut[visual_output]
        Stream[streaming]
    end

    subgraph "MaiBotï¼ˆå¤–éƒ¨ï¼‰"
        MaiCore[MaiCore]
    end

    Router <--> MaiCore
    Router --> Pipeline
    Pipeline --> Core
    Core <--> HTTP

    Core --> EventBus
    Core --> Context

    Core --> AudioIn
    Core --> LangProc
    Core --> ExprGen
    Core --> VirtRend
    Core --> AudioOut
    Core --> VisOut
    Core --> Stream

    EventBus -.äº‹ä»¶é€šçŸ¥.-> AudioIn
    EventBus -.äº‹ä»¶é€šçŸ¥.-> LangProc
    EventBus -.äº‹ä»¶é€šçŸ¥.-> ExprGen
    EventBus -.äº‹ä»¶é€šçŸ¥.-> VirtRend

    style Core fill:#f9f,stroke:#333,stroke-width:3px
    style MaiCore fill:#ff9,stroke:#333,stroke-width:2px
    style Router fill:#bbf,stroke:#333,stroke-width:2px
```

**å…³é”®ç‚¹**ï¼š
- âœ… MaiBotæ— æ„ŸçŸ¥ï¼šé€šä¿¡åè®®å®Œå…¨ç›¸åŒ
- âœ… ç®¡é“ç³»ç»Ÿç»§ç»­å·¥ä½œï¼šæ¶ˆæ¯é¢„å¤„ç†æœºåˆ¶ä¸å˜
- âœ… åŠŸèƒ½åŸŸåªå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼šä¸æ¶‰åŠä¼ è¾“å±‚
- âœ… æ¸è¿›å¼è¿ç§»ï¼šå¯ä»¥å…ˆé‡æ„ä¸šåŠ¡é€»è¾‘ï¼Œä¼ è¾“å±‚ä¿æŒç¨³å®š

---

### 1. éŸ³é¢‘è¾“å…¥åŸŸ (audio_input)

**èŒè´£**ï¼šæ¥æ”¶å¤–éƒ¨éŸ³é¢‘/æ–‡æœ¬è¾“å…¥

#### æ ¸å¿ƒæ¥å£

```python
# è®¾è®¡æ€è·¯ï¼šå®šä¹‰æ¥å£ï¼Œå…·ä½“å®ç°åœ¨implementations/ä¸­

class AudioInput(ABC):
    @abstractmethod
    async def start_stream(self) -> AsyncIterator[AudioFrame]:
        """å¼€å§‹éŸ³é¢‘æµ"""

    @abstractmethod
    async def stop_stream(self):
        """åœæ­¢éŸ³é¢‘æµ"""
```

#### å®ç°åˆ†ç±»

| å®ç°æ–¹å¼ | å¤„ç†å»ºè®® |
|---------|---------|
| **éº¦å…‹é£è¾“å…¥** | æ¨¡å—é»˜è®¤å®ç° |
| **éŸ³é¢‘æµè¾“å…¥** | æ¨¡å—é»˜è®¤å®ç° |
| **æ§åˆ¶å°è¾“å…¥** | æ¨¡å—å®ç°ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰ |
| **å¼¹å¹•è¾“å…¥** | **æ‰©å±•**ï¼ˆå¹³å°ç›¸å…³ï¼‰ |

#### é…ç½®ç¤ºä¾‹

```toml
[audio_input]
# ä¸»è¾“å…¥æº
primary_source = "microphone"  # microphone, stream, console

[audio_input.microphone]
device_index = 0
sample_rate = 16000

[audio_input.stream]
url = "http://example.com/audio.stream"
```

---

### 2. è¯­è¨€å¤„ç†åŸŸ (language_processing)

**èŒè´£**ï¼šå°†éŸ³é¢‘/æ–‡æœ¬è½¬æ¢ä¸ºå¯ç†è§£çš„ä¿¡æ¯

#### æ ¸å¿ƒæ¥å£

```python
class SpeechRecognizer(ABC):
    @abstractmethod
    async def recognize(self, audio: AudioFrame) -> str:
        """è¯­éŸ³è½¬æ–‡æœ¬"""

class LanguageModel(ABC):
    @abstractmethod
    async def generate(self, prompt: str) -> str:
        """æ–‡æœ¬ç”Ÿæˆ"""
```

#### å®ç°åˆ†ç±»

| å®ç°æ–¹å¼ | å¤„ç†å»ºè®® |
|---------|---------|
| **Edge STT** | æ¨¡å—å®ç° |
| **FunASR STT** | æ¨¡å—å®ç°ï¼ˆå¯é€‰ï¼‰ |
| **OpenAI LLM** | æ¨¡å—å®ç°ï¼ˆé»˜è®¤ï¼‰ |
| **æœ¬åœ°LLM** | æ¨¡å—å®ç°ï¼ˆå¯é€‰ï¼‰ |
| **ä¸Šä¸‹æ–‡ç®¡ç†** | æ¨¡å—æ ¸å¿ƒåŠŸèƒ½ |

#### é…ç½®ç¤ºä¾‹

```toml
[language_processing.stt]
provider = "edge"  # edge, funasr

[language_processing.llm]
provider = "openai"  # openai, local
model = "gpt-4"

[language_processing.context]
max_history = 10
```

---

### 3. è¡¨æƒ…ç”ŸæˆåŸŸ (expression_generation)

**èŒè´£**ï¼šç†è§£æ–‡æœ¬å¹¶ç”Ÿæˆè¡¨æƒ…/åŠ¨ä½œå‚æ•°

#### æ ¸å¿ƒåŠŸèƒ½

```python
class ExpressionGenerator:
    async def generate_expression(
        self,
        text: str,
        emotion_context: EmotionHistory
    ) -> ExpressionParameters:
        """ç”Ÿæˆè¡¨æƒ…å‚æ•°"""
```

#### åŠŸèƒ½æ¨¡å—

| æ¨¡å— | åŠŸèƒ½ | å¤„ç†å»ºè®® |
|------|------|---------|
| **æƒ…æ„Ÿåˆ†æ** | åˆ†ææ–‡æœ¬æƒ…æ„Ÿ | æ¨¡å—æ ¸å¿ƒï¼ˆä½¿ç”¨LLMï¼‰ |
| **åŠ¨ä½œæ˜ å°„** | å°†æƒ…æ„Ÿæ˜ å°„ä¸ºå‚æ•° | æ¨¡å—æ ¸å¿ƒ |
| **è§¦å‘å¼•æ“** | å…³é”®è¯è§¦å‘åŠ¨ä½œ | æ¨¡å—åŠŸèƒ½ |
| **æ™ºèƒ½è§¦å‘ç­–ç•¥** | è¿‡æ»¤+æ—¶é—´+LLMåˆ¤æ–­ | æ¨¡å—åŠŸèƒ½ |

#### é…ç½®ç¤ºä¾‹

```toml
[expression_generation]
# è§¦å‘ç­–ç•¥
trigger_strategy = "intelligent"  # simple, intelligent

[expression_generation.intelligent]
simple_reply_filter = true
time_interval = 5.0
llm_judge = true
```

---

### 4. è™šæ‹Ÿæ¸²æŸ“åŸŸ (virtual_rendering)

**èŒè´£**ï¼šé©±åŠ¨è™šæ‹Ÿå½¢è±¡æ¸²æŸ“

#### æ ¸å¿ƒæ¥å£

```python
class VirtualRenderer(ABC):
    @abstractmethod
    async def connect(self) -> bool:
        """è¿æ¥åˆ°æ¸²æŸ“æœåŠ¡"""

    @abstractmethod
    async def set_parameters(self, params: List[Parameter]):
        """è®¾ç½®å‚æ•°"""

    @abstractmethod
    async def trigger_hotkey(self, hotkey_id: str):
        """è§¦å‘çƒ­é”®"""
```

#### å®ç°åˆ†ç±»

| å®ç°æ–¹å¼ | å¤„ç†å»ºè®® |
|---------|---------|
| **VTube Studio** | æ¨¡å—å®ç°ï¼ˆä¸»è¦ï¼‰ |
| **Warudo** | æ¨¡å—å®ç°ï¼ˆå¯é€‰ï¼‰ |
| **OBS Studio** | æ¨¡å—å®ç°ï¼ˆæ¨æµåœºæ™¯ï¼‰ |
| **VRChat** | **æ‰©å±•**ï¼ˆVRç‰¹å®šåœºæ™¯ï¼‰ |

#### é…ç½®ç¤ºä¾‹

```toml
[virtual_rendering]
# ä¸»æ¸²æŸ“å™¨
primary_renderer = "vts"  # vts, warudo, obs

[virtual_rendering.vts]
host = "localhost"
port = 8001

# è¯­ä¹‰åŠ¨ä½œæ˜ å°„ï¼ˆè·¨å¹³å°ï¼‰
[virtual_rendering.expressions.happy]
MouthSmile = 1.0
EyeOpenLeft = 0.9
```

---

### 5. éŸ³é¢‘è¾“å‡ºåŸŸ (audio_output)

**èŒè´£**ï¼šè¯­éŸ³åˆæˆå’Œæ’­æ”¾

#### æ ¸å¿ƒæ¥å£

```python
class TextToSpeech(ABC):
    @abstractmethod
    async def synthesize(self, text: str) -> AudioData:
        """æ–‡æœ¬è½¬è¯­éŸ³"""

class AudioPlayer:
    async def play(self, audio: AudioData):
        """æ’­æ”¾éŸ³é¢‘"""
```

#### å®ç°åˆ†ç±»

| å®ç°æ–¹å¼ | å¤„ç†å»ºè®® |
|---------|---------|
| **Edge TTS** | æ¨¡å—å®ç°ï¼ˆé»˜è®¤ï¼‰ |
| **GPT-SoVITS** | æ¨¡å—å®ç°ï¼ˆå¯é€‰ï¼‰ |
| **Omni TTS** | æ¨¡å—å®ç°ï¼ˆå¯é€‰ï¼Œæ•´åˆåˆ°ä¸»TTSï¼‰ |
| **éŸ³é¢‘æ’­æ”¾** | æ¨¡å—æ ¸å¿ƒåŠŸèƒ½ |
| **å£å‹åŒæ­¥** | æ¨¡å—æ ¸å¿ƒåŠŸèƒ½ |
| **å­—å¹•ç”Ÿæˆ** | è¿ç§»åˆ°visual_output |

#### é…ç½®ç¤ºä¾‹

```toml
[audio_output.tts]
provider = "edge"  # edge, gptsovits, omni

[audio_output.tts.edge]
voice = "zh-CN-XiaoxiaoNeural"

[audio_output.playback]
device = "default"
lip_sync = true
```

---

### 6. è§†è§‰è¾“å‡ºåŸŸ (visual_output)

**èŒè´£**ï¼šå­—å¹•ã€è´´çº¸ç­‰è§†è§‰å…ƒç´ æ¸²æŸ“

#### æ ¸å¿ƒåŠŸèƒ½

```python
class SubtitleRenderer:
    async def show_subtitle(self, text: str, duration: float):
        """æ˜¾ç¤ºå­—å¹•"""

class StickerRenderer:
    async def show_sticker(self, image: ImageData, position: Position):
        """æ˜¾ç¤ºè´´çº¸"""
```

#### å®ç°åˆ†ç±»

| åŠŸèƒ½ | å¤„ç†å»ºè®® |
|------|---------|
| **å­—å¹•æ¸²æŸ“** | æ¨¡å—å®ç°ï¼ˆæ”¯æŒå¤šå¼•æ“ï¼‰ |
| **è´´çº¸æ¸²æŸ“** | æ¨¡å—å®ç°ï¼ˆæ”¯æŒå¤šå¼•æ“ï¼‰ |
| **æ¸²æŸ“å¼•æ“** | PyQt / Pygame / æµè§ˆå™¨ |

#### é…ç½®ç¤ºä¾‹

```toml
[visual_output.subtitle]
enabled = true
renderer = "pyqt"  # pyqt, pygame, browser

[visual_output.sticker]
enabled = false
renderer = "pyqt"
```

---

### 7. ç›´æ’­æ¨æµåŸŸ (streaming)

**èŒè´£**ï¼šæ¨æµåˆ°ç›´æ’­å¹³å°

#### æ ¸å¿ƒåŠŸèƒ½

```python
class Streamer(ABC):
    @abstractmethod
    async def start_stream(self, platform: str):
        """å¼€å§‹æ¨æµ"""

    @abstractmethod
    async def stop_stream(self):
        """åœæ­¢æ¨æµ"""
```

#### å®ç°åˆ†ç±»

| å®ç°æ–¹å¼ | å¤„ç†å»ºè®® |
|---------|---------|
| **OBSæ¨æµ** | æ¨¡å—å®ç°ï¼ˆé€šè¿‡WebSocketæ§åˆ¶ï¼‰ |
| **å¹³å°æ¨æµ** | **æ‰©å±•**ï¼ˆå¹³å°ç›¸å…³ï¼‰ |

---

## ğŸ“ é…ç½®ç³»ç»Ÿè®¾è®¡

### é…ç½®æ–‡ä»¶å±‚æ¬¡

```toml
# config-template.toml

# === 1. å…¨å±€é…ç½® ===
[general]
platform_id = "amaidesu_default"

# === 2. åŠŸèƒ½åŸŸé…ç½® ===
[audio_input]
primary_source = "microphone"

[language_processing]
stt_provider = "edge"
llm_provider = "openai"

[expression_generation]
trigger_strategy = "intelligent"

[virtual_rendering]
primary_renderer = "vts"

[audio_output]
tts_provider = "edge"

[visual_output]
subtitle_enabled = true

# === 3. åŠŸèƒ½åŸŸå†…å®ç°é…ç½® ===
[audio_input.microphone]
device_index = 0

[language_processing.llm.openai]
model = "gpt-4"

[virtual_rendering.vts]
host = "localhost"
port = 8001

[audio_output.tts.edge]
voice = "zh-CN-XiaoxiaoNeural"

# === 4. æ’ä»¶é…ç½® ===
[plugins]
enabled_internal = ["bili_danmaku", "mainosaba"]
enabled_external = []

[plugins.bili_danmaku]
room_id = 0
```

### é…ç½®ä¼˜å…ˆçº§

1. **åŠŸèƒ½åŸŸé…ç½®** > é»˜è®¤é…ç½®
2. **å®ç°é…ç½®** > åŠŸèƒ½åŸŸé…ç½®
3. **æ’ä»¶é…ç½®**ç‹¬ç«‹ç®¡ç†

---

## ğŸš€ è¿ç§»è·¯å¾„

### ç¬¬ä¸€é˜¶æ®µï¼šåŠŸèƒ½åŸŸåŸºç¡€è®¾æ–½ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹æ–°çš„ç›®å½•ç»“æ„å’Œæ ¸å¿ƒåŸºç¡€è®¾æ–½

#### ä»»åŠ¡

1. åˆ›å»ºåŠŸèƒ½åŸŸç›®å½•ç»“æ„
2. å®ç°æ¨¡å—åŠ è½½å™¨ï¼ˆæ›¿ä»£/æ”¹è¿›æ’ä»¶ç®¡ç†å™¨ï¼‰
3. å®šä¹‰å„åŠŸèƒ½åŸŸçš„æ ¸å¿ƒæ¥å£
4. æ›´æ–°é…ç½®ç³»ç»Ÿ
5. ç¼–å†™è¿ç§»æ–‡æ¡£

#### éªŒè¯æ ‡å‡†

- âœ… æ–°ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ
- âœ… æ¨¡å—åŠ è½½å™¨å¯ä»¥åŠ è½½æ¨¡å—
- âœ… é…ç½®ç³»ç»Ÿæ”¯æŒæ–°æ ¼å¼
- âœ… å‘åå…¼å®¹ï¼ˆç°æœ‰ç³»ç»Ÿä»å¯è¿è¡Œï¼‰

---

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§»ï¼ˆ3-4å‘¨ï¼‰

**ç›®æ ‡**ï¼šè¿ç§»æ ¸å¿ƒåŠŸèƒ½åˆ°åŠŸèƒ½åŸŸæ¨¡å—

#### ä»»åŠ¡

1. **éŸ³é¢‘è¾“å…¥åŸŸ**
   - è¿ç§»console_input â†’ audio_input/text_input/
   - è¿ç§»microphoneè¾“å…¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

2. **è¯­è¨€å¤„ç†åŸŸ**
   - è¿ç§»STTåŠŸèƒ½ â†’ language_processing/implementations/
   - æ•´åˆLLMå®¢æˆ·ç«¯

3. **éŸ³é¢‘è¾“å‡ºåŸŸ**
   - è¿ç§»TTS â†’ audio_output/implementations/
   - æ•´åˆ3ä¸ªTTSå®ç°ä¸ºä¸€ä¸ªæ¨¡å—

4. **è™šæ‹Ÿæ¸²æŸ“åŸŸ**
   - è¿ç§»VTSé€‚é…å™¨ â†’ virtual_rendering/implementations/
   - ä¿ç•™AvatarControlManager

#### éªŒè¯æ ‡å‡†

- âœ… è¿ç§»çš„åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- âœ… é…ç½®æ›´ç®€æ´ï¼ˆä¸€ä¸ª[tts]å—æ›¿ä»£å¤šä¸ªæ’ä»¶é…ç½®ï¼‰
- âœ… æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

---

### ç¬¬ä¸‰é˜¶æ®µï¼šè¡¨æƒ…ç”Ÿæˆä¸è¾“å‡ºï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®Œå–„è¡¨æƒ…ç”Ÿæˆå’Œè§†è§‰è¾“å‡º

#### ä»»åŠ¡

1. **è¡¨æƒ…ç”ŸæˆåŸŸ**
   - åˆ›å»ºexpression_generationæ¨¡å—
   - è¿ç§»æƒ…æ„Ÿåˆ†æé€»è¾‘
   - å®ç°æ™ºèƒ½è§¦å‘ç­–ç•¥

2. **è§†è§‰è¾“å‡ºåŸŸ**
   - è¿ç§»subtitle â†’ visual_output/
   - è¿ç§»sticker â†’ visual_output/

#### éªŒè¯æ ‡å‡†

- âœ… è¡¨æƒ…ç”ŸæˆåŠŸèƒ½æ­£å¸¸
- âœ… å­—å¹•ã€è´´çº¸æ¸²æŸ“æ­£å¸¸

---

### ç¬¬å››é˜¶æ®µï¼šæ’ä»¶ç³»ç»Ÿé‡æ„ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**ï¼šé‡æ„æ’ä»¶ç³»ç»Ÿï¼Œæ˜ç¡®æ–°å®šä½

#### ä»»åŠ¡

1. **ç®€åŒ–æ’ä»¶API**
   - ç§»é™¤æœåŠ¡æ³¨å†Œæœºåˆ¶ï¼ˆé˜²æ­¢ä¾èµ–åœ°ç‹±ï¼‰
   - ä»…ä¿ç•™äº‹ä»¶è®¢é˜…å’ŒHTTPè·¯ç”±æ³¨å†Œ

2. **è¿ç§»æ ¸å¿ƒåŠŸèƒ½åˆ°æ¨¡å—**
   - æŒ‰æ’ä»¶å¤„ç†æ¸…å•è¿ç§»
   - æ›´æ–°é…ç½®æ–‡ä»¶

3. **è¿ç§»å¹³å°/æ¸¸æˆé›†æˆåˆ°æ’ä»¶**
   - bili_danmaku â†’ plugins/internal/
   - æ¸¸æˆé›†æˆ â†’ plugins/internal/game_integration/

4. **ç§»é™¤åºŸå¼ƒæ’ä»¶**
   - mock_danmaku
   - é‡å¤çš„å®ç°

5. **æ›´æ–°æ’ä»¶å¼€å‘æ–‡æ¡£**

#### éªŒè¯æ ‡å‡†

- âœ… æ’ä»¶ç³»ç»ŸåŠ è½½æ­£å¸¸
- âœ… æ ¸å¿ƒåŠŸèƒ½è¿ç§»å®Œæˆ
- âœ… æ’ä»¶é—´æ— å¾ªç¯ä¾èµ–
- âœ… æ’ä»¶å¼€å‘æ–‡æ¡£å®Œæ•´

---

### ç¬¬äº”é˜¶æ®µï¼šæ¸…ç†ä¸ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ¸…ç†ä»£ç ï¼Œä¼˜åŒ–æ€§èƒ½ï¼Œå®Œå–„æ–‡æ¡£

#### ä»»åŠ¡

1. æ¸…ç†æ—§ä»£ç å’Œæ³¨é‡Š
2. ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
3. å®Œå–„æ¶æ„æ–‡æ¡£
4. æ›´æ–°READMEå’ŒCLAUDE.md
5. ç¼–å†™è¿ç§»æŒ‡å—

#### éªŒè¯æ ‡å‡†

- âœ… ä»£ç è´¨é‡æå‡
- âœ… æ–‡æ¡£å®Œæ•´
- âœ… ç”¨æˆ·åé¦ˆæ­£é¢

---

## ğŸ“Š æ¶æ„å¯¹æ¯”

### å½“å‰æ¶æ„ vs æ–°æ¶æ„

| ç»´åº¦ | å½“å‰æ¶æ„ | æ–°æ¶æ„ |
|------|---------|--------|
| **ç»„ç»‡æ–¹å¼** | æŒ‰æŠ€æœ¯æ¨¡å¼ï¼ˆæ’ä»¶ï¼‰ | æŒ‰åŠŸèƒ½åŸŸï¼ˆä¸šåŠ¡æµç¨‹ï¼‰ |
| **TTSé…ç½®** | 3ä¸ªç‹¬ç«‹æ’ä»¶ï¼Œåˆ†æ•£é…ç½® | 1ä¸ªæ¨¡å—ï¼Œç»Ÿä¸€é…ç½® |
| **æ ¸å¿ƒåŠŸèƒ½** | æ··åœ¨æ’ä»¶ä¸­ | ç‹¬ç«‹çš„æ¨¡å—ï¼Œæ¸…æ™° |
| **æ‰©å±•æœºåˆ¶** | å®Œæ•´çš„æ’ä»¶ç³»ç»Ÿï¼ˆ24ä¸ªï¼‰ | ç²¾ç®€çš„æ’ä»¶ç³»ç»Ÿï¼ˆçº¦8ä¸ªï¼‰ |
| **é…ç½®å¤æ‚åº¦** | é«˜ï¼ˆ20+æ’ä»¶ï¼‰ | ä½ï¼ˆ7ä¸ªåŠŸèƒ½åŸŸ+8ä¸ªæ’ä»¶ï¼‰ |
| **æ–°å¼€å‘è€…å‹å¥½åº¦** | ä½ï¼ˆéœ€è¦ç†è§£æ’ä»¶ç³»ç»Ÿï¼‰ | é«˜ï¼ˆæŒ‰ä¸šåŠ¡æµç¨‹ç»„ç»‡ï¼‰ |

### æ’ä»¶å¤„ç†æ¸…å•ï¼ˆå®Œæ•´ç‰ˆ24ä¸ªï¼‰

#### æ ¸å¿ƒåŠŸèƒ½è¿ç§»åˆ°æ¨¡å—ï¼ˆ13ä¸ªï¼‰

| æ’ä»¶ | åŠŸèƒ½è¯´æ˜ | å¤„ç†æ–¹å¼ | æ–°ä½ç½® |
|------|---------|---------|--------|
| console_input | æ§åˆ¶å°è¾“å…¥ | è¿ç§»åˆ°æ¨¡å— | audio_input/text_input/ |
| keyword_action | å…³é”®è¯åŠ¨ä½œè§¦å‘ | è¿ç§»åˆ°æ¨¡å— | expression_generation/ |
| emotion_judge | æƒ…æ„Ÿåˆ¤æ–­ä¸çƒ­é”®è§¦å‘ | æ•´åˆåˆ°æ¨¡å— | expression_generation/ |
| tts | Edge TTSè¯­éŸ³åˆæˆ | æ•´åˆåˆ°æ¨¡å— | audio_output/implementations/ |
| gptsovits_tts | GPT-SoVITSè¯­éŸ³åˆæˆ | æ•´åˆä¸ºå®ç° | audio_output/implementations/ |
| omni_tts | Omni TTSè¯­éŸ³åˆæˆ | æ•´åˆä¸ºå®ç° | audio_output/implementations/ |
| vtube_studio | VTube Studioæ§åˆ¶ | è¿ç§»åˆ°æ¨¡å— | virtual_rendering/implementations/ |
| warudo | Warudoæ§åˆ¶ | è¿ç§»åˆ°æ¨¡å— | virtual_rendering/implementations/ |
| obs_control | OBS Studioæ§åˆ¶ | è¿ç§»åˆ°æ¨¡å— | virtual_rendering/implementations/ |
| vrchat | VRChatæ§åˆ¶ | è¿ç§»åˆ°æ¨¡å— | virtual_rendering/implementations/ |
| stt | Edge STTè¯­éŸ³è¯†åˆ« | è¿ç§»åˆ°æ¨¡å— | language_processing/implementations/ |
| funasr_stt | FunASRè¯­éŸ³è¯†åˆ« | æ•´åˆä¸ºå®ç° | language_processing/implementations/ |
| llm_text_processor | LLMæ–‡æœ¬å¤„ç† | è¿ç§»åˆ°æ¨¡å— | language_processing/ |
| subtitle | å­—å¹•æ¸²æŸ“ | è¿ç§»åˆ°æ¨¡å— | visual_output/ |
| sticker | è´´çº¸æ¸²æŸ“ | è¿ç§»åˆ°æ¨¡å— | visual_output/ |

#### ä¿ç•™ä¸ºæ’ä»¶ï¼ˆ8ä¸ªï¼‰

| æ’ä»¶ | åŠŸèƒ½è¯´æ˜ | ä¿ç•™ç†ç”± | æ–°ä½ç½® |
|------|---------|---------|--------|
| bili_danmaku | Bç«™å¼¹å¹•è¾“å…¥ï¼ˆSeleniumç‰ˆï¼‰ | å¹³å°ç‰¹å®šé›†æˆ | plugins/internal/platform_integration/ |
| bili_danmaku_official | Bç«™å®˜æ–¹å¼¹å¹•è¾“å…¥ | å¹³å°ç‰¹å®šé›†æˆ | plugins/internal/platform_integration/ |
| bili_danmaku_official_maicraft | Bç«™å¼¹å¹•-MaiCraftç‰ˆ | å¹³å°ç‰¹å®šé›†æˆ | plugins/internal/platform_integration/ |
| mainosaba | é­”è£æ¸¸æˆé›†æˆ | æ¸¸æˆé›†æˆ | plugins/internal/game_integration/ |
| arknights | æ˜æ—¥æ–¹èˆŸæ¸¸æˆé›†æˆ | æ¸¸æˆé›†æˆ | plugins/internal/game_integration/ |
| minecraft | æˆ‘çš„ä¸–ç•Œæ¸¸æˆé›†æˆ | æ¸¸æˆé›†æˆ | plugins/internal/game_integration/ |
| maicraft | MaiCraftå¼¹å¹•äº’åŠ¨æ¸¸æˆ | æ¸¸æˆé›†æˆï¼ˆå·¥å‚æ¨¡å¼ï¼‰ | plugins/internal/game_integration/ |
| read_pingmu | å±å¹•ç›‘æ§ä¸VLåˆ†æ | ç‰¹å®šè¾“å…¥æ–¹å¼ | plugins/internal/tools/ |
| screen_monitor | å±å¹•ç›‘æ§ | è°ƒè¯•å·¥å…· | plugins/internal/tools/ |
| remote_stream | è¾¹ç¼˜è®¾å¤‡éŸ³è§†é¢‘æµ | ç‰¹å®šéƒ¨ç½²åœºæ™¯ | plugins/internal/tools/ |
| dg_lab_service | DG-Labç¡¬ä»¶æ§åˆ¶ | ç¡¬ä»¶é›†æˆ | plugins/internal/ |

#### åºŸå¼ƒï¼ˆ1ä¸ªï¼‰

| æ’ä»¶ | åºŸå¼ƒç†ç”± |
|------|---------|
| mock_danmaku | æµ‹è¯•å·¥å…·ï¼Œåº”ç§»è‡³tests/ |

#### ç‰¹æ®Šè¯´æ˜

**emotion_judgeæ’ä»¶æ•´åˆç†ç”±**ï¼š
- å½“å‰åŠŸèƒ½ï¼šæ ¹æ®LLMå›å¤åˆ¤æ–­æƒ…æ„Ÿå¹¶è§¦å‘çƒ­é”®
- ä¸expression_generationåŸŸçš„åŠŸèƒ½é‡å¤ï¼šè¡¨æƒ…ç”ŸæˆåŸŸå·²åŒ…å«æƒ…æ„Ÿåˆ†æå’Œè§¦å‘é€»è¾‘
- æ•´åˆæ–¹æ¡ˆï¼šå°†emotion_judgeçš„LLMæƒ…æ„Ÿåˆ†æèƒ½åŠ›æ•´åˆåˆ°è¡¨æƒ…ç”ŸæˆåŸŸçš„æ™ºèƒ½è§¦å‘ç­–ç•¥ä¸­

**maicraftæ’ä»¶ä¿ç•™ç†ç”±**ï¼š
- å·²é‡‡ç”¨è‰¯å¥½çš„æŠ½è±¡å·¥å‚æ¨¡å¼è®¾è®¡
- æ˜¯æ¸¸æˆé›†æˆçš„å…¸å‹ç¤ºä¾‹
- ä¸å±äºAI VTuberæ ¸å¿ƒå·¥ä½œæµï¼Œç¬¦åˆæ’ä»¶å®šä½

---

## âœ… æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡

- âœ… æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- âœ… é…ç½®æ–‡ä»¶è¡Œæ•°å‡å°‘40%ä»¥ä¸Š
- âœ… æ ¸å¿ƒåŠŸèƒ½å“åº”æ—¶é—´æ— å¢åŠ 
- âœ… ä»£ç é‡å¤ç‡é™ä½30%ä»¥ä¸Š

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

- âœ… æ–°å¼€å‘è€…èƒ½åœ¨30åˆ†é’Ÿå†…ç†è§£æ¶æ„
- âœ… é…ç½®é”™è¯¯èƒ½ç»™å‡ºæ¸…æ™°çš„æç¤º
- âœ… æ–‡æ¡£è¦†ç›–ç‡è¾¾åˆ°95%ä»¥ä¸Š
- âœ… ç¤¾åŒºåé¦ˆæ­£é¢

### æ¶æ„æŒ‡æ ‡

- âœ… æ¸…æ™°çš„ä¸ƒå±‚åŠŸèƒ½åŸŸæ¶æ„
- âœ… æ¨¡å—é—´ä¾èµ–å…³ç³»æ¸…æ™°
- âœ… æ‰©å±•ç³»ç»Ÿç²¾ç®€ä½†è¶³å¤Ÿçµæ´»
- âœ… æ˜“äºæ·»åŠ æ–°åŠŸèƒ½åŸŸ

---

## ğŸ¯ ä¸è®¨è®ºæœŸæœ›çš„å¯¹ç…§

### ç”¨æˆ·æ ¸å¿ƒé—®é¢˜ç¡®è®¤

**é—®é¢˜1ï¼šç°åœ¨çš„åŠŸèƒ½åŸŸè¶³å¤Ÿäº†å—ï¼Ÿè¦†ç›–å…¨é¢äº†å—ï¼Ÿ**

âœ… **å›ç­”ï¼šæ˜¯çš„ï¼Œ7ä¸ªåŠŸèƒ½åŸŸå®Œå…¨è¦†ç›–AI VTuberæ ¸å¿ƒå·¥ä½œæµç¨‹**

éªŒè¯ä¾æ®ï¼š
- å®Œæ•´åˆ†æ24ä¸ªç°æœ‰æ’ä»¶
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„åŠŸèƒ½åŸŸï¼š
  - éŸ³é¢‘/æ–‡æœ¬è¾“å…¥ â†’ audio_input
  - è¯­éŸ³è¯†åˆ«/LLMå¤„ç† â†’ language_processing
  - æƒ…æ„Ÿåˆ†æ/åŠ¨ä½œè§¦å‘ â†’ expression_generation
  - è™šæ‹Ÿå½¢è±¡é©±åŠ¨ â†’ virtual_rendering
  - è¯­éŸ³åˆæˆ/æ’­æ”¾ â†’ audio_output
  - å­—å¹•/è´´çº¸æ¸²æŸ“ â†’ visual_output
  - æ¨æµæ§åˆ¶ â†’ streaming
- ç‰¹æ®ŠåŠŸèƒ½ï¼ˆå±å¹•ç›‘æ§ã€è¾¹ç¼˜è®¡ç®—ã€æ¸¸æˆé›†æˆï¼‰ä¿ç•™ä¸ºæ’ä»¶
- åŠŸèƒ½æ•´åˆï¼šemotion_judgeæ•´åˆåˆ°expression_generation

**é—®é¢˜2ï¼šå…³äºå’ŒMaiBotçš„é€šä¿¡æœ‰å˜åŒ–å—ï¼Ÿ**

âŒ **å›ç­”ï¼šå®Œå…¨æ— å˜åŒ–**

æ¶æ„åˆ†å±‚ï¼š
- **ä¼ è¾“å±‚ï¼ˆä¸å˜ï¼‰**ï¼šWebSocket Routerã€HTTP Serverã€PipelineManager
- **æ ¸å¿ƒå±‚ï¼ˆä¸å˜ï¼‰**ï¼šAmaidesuCoreã€EventBusã€ContextManager
- **åŠŸèƒ½åŸŸå±‚ï¼ˆé‡æ„ç›®æ ‡ï¼‰**ï¼š7ä¸ªåŠŸèƒ½åŸŸæ¨¡å—

å…³é”®ä¿è¯ï¼š
- âœ… MaiBotæ— æ„ŸçŸ¥ï¼šé€šä¿¡åè®®å®Œå…¨ç›¸åŒ
- âœ… ç®¡é“ç³»ç»Ÿç»§ç»­å·¥ä½œï¼šæ¶ˆæ¯é¢„å¤„ç†æœºåˆ¶ä¸å˜
- âœ… åŠŸèƒ½åŸŸåªå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼šä¸æ¶‰åŠä¼ è¾“å±‚
- âœ… æ¸è¿›å¼è¿ç§»ï¼šå¯ä»¥å…ˆé‡æ„ä¸šåŠ¡é€»è¾‘ï¼Œä¼ è¾“å±‚ä¿æŒç¨³å®š

---

### ç¬¬ä¸€ä»½è®¨è®ºæœŸæœ›

| æœŸæœ› | å®ç°æ–¹å¼ |
|------|---------|
| **"æ‰€æœ‰ç”¨æˆ·å¿…éœ€çš„åŠŸèƒ½åº”è¯¥å«moduleè€Œéplugin" - å¢¨æ¢“æŸ’** | âœ… æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨æ¨¡å—åŒ–ï¼ŒæŒ‰åŠŸèƒ½åŸŸç»„ç»‡ |
| **"ä¸»è¦çŸ›ç›¾æ˜¯ç¨³å®šæ€§è€Œéèƒ½å¦åˆ†ç¦»" - åƒçŸ³å¯ä¹** | âœ… åŠŸèƒ½åŸŸæ¥å£ç¨³å®šï¼Œå•å‘æ•°æ®æµä¿è¯ç¨³å®šæ€§ |
| **"æ¶æ„å¾ˆcoolï¼Œä½¿ç”¨å¾ˆç‹—å±" - tc_é­”æ³•å£«** | âœ… æŒ‰ä¸šåŠ¡æµç¨‹ç»„ç»‡ï¼Œæ›´ç›´è§‚æ˜“ç”¨ |
| **"æ’ä»¶æ’åˆ—ç»„åˆå›°éš¾"** | âœ… æ¨¡å—é—´æ— å¾ªç¯ä¾èµ–ï¼Œæ’ä»¶ä»…é€šè¿‡äº‹ä»¶é€šä¿¡ |
| **"ä¿ç•™æ’ä»¶ç³»ç»Ÿç”¨äºçœŸæ­£æ‰©å±•"** | âœ… æ’ä»¶ç³»ç»Ÿä»…ç”¨äºå¹³å°/æ¸¸æˆé›†æˆ |

### ç¬¬äºŒä»½è®¨è®ºæœŸæœ›

| æœŸæœ› | å®ç°æ–¹å¼ |
|------|---------|
| **"äº”å±‚æ¶æ„ï¼šéŸ³è¾“å…¥â†’è¯­è¨€æ¨ç†â†’è¡¨æƒ…åŠ¨ä½œâ†’è™šæ‹Ÿæ¸²æŸ“â†’ç›´æ’­æ¨æµ" - éº¦éº¦** | âœ… æŒ‰æ­¤æµç¨‹ç»„ç»‡åŠŸèƒ½åŸŸï¼ˆå®é™…7å±‚ï¼Œå¢åŠ éŸ³è¾“å‡ºå’Œè§†è¾“å‡ºï¼‰ |
| **"åŒä¸€åŠŸèƒ½æ”¶æ•›åˆ°ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œç”¨ç­–ç•¥æ¨¡å¼æˆ–å·¥å‚åŠ¨æ€é€‰å®ç°"** | âœ… æ¯ä¸ªåŠŸèƒ½åŸŸå®šä¹‰æ¥å£ï¼Œå®ç°åœ¨implementations/ä¸­ |
| **"é©±åŠ¨å±‚åªè¾“å‡ºå‚æ•°ï¼Œæ¸²æŸ“å±‚åªç®¡ç”»å›¾"** | âœ… expression_generationè¾“å‡ºå‚æ•°ï¼Œvirtual_renderingè´Ÿè´£æ¸²æŸ“ |
| **"æ’ä»¶ç•™ç€åšè¾¹ç¼˜æ‰©å±•"** | âœ… æ’ä»¶ç³»ç»Ÿä»…ç”¨äºå¹³å°/æ¸¸æˆé›†æˆ |

---

## ğŸ“š é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **åŠŸèƒ½åŸŸ** | æŒ‰AI VTuberä¸šåŠ¡æµç¨‹åˆ’åˆ†çš„åŠŸèƒ½æ¨¡å—ï¼Œå¦‚audio_input, virtual_rendering |
| **æ¨¡å—** | æ ¸å¿ƒåŠŸèƒ½çš„å®ç°ï¼Œä½äºsrc/{åŠŸèƒ½åŸŸ}/ä¸‹ |
| **å®ç°** | åŠŸèƒ½åŸŸå†…çš„å…·ä½“å®ç°æ–¹å¼ï¼Œä½äºimplementations/ç›®å½• |
| **æ’ä»¶** | å¯é€‰çš„å¹³å°/æ¸¸æˆé›†æˆï¼Œä½äºplugins/ç›®å½• |
| **æ¥å£** | åŠŸèƒ½åŸŸå®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œè§„èŒƒå®ç°çš„è¡Œä¸º |

### B. Mermaidæ¶æ„å›¾

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        Main[main.py]
    end

    subgraph "æ ¸å¿ƒå±‚"
        Core[AmaidesuCore]
        EventBus[EventBus]
        ModuleLoader[ModuleLoader]
    end

    subgraph "åŠŸèƒ½åŸŸå±‚"
        AudioIn[audio_input<br/>éŸ³é¢‘è¾“å…¥]
        LangProc[language_processing<br/>è¯­è¨€å¤„ç†]
        ExprGen[expression_generation<br/>è¡¨æƒ…ç”Ÿæˆ]
        VirtRend[virtual_rendering<br/>è™šæ‹Ÿæ¸²æŸ“]
        AudioOut[audio_output<br/>éŸ³é¢‘è¾“å‡º]
        VisOut[visual_output<br/>è§†è§‰è¾“å‡º]
        Stream[streaming<br/>ç›´æ’­æ¨æµ]
    end

    subgraph "æ’ä»¶å±‚ï¼ˆå¯é€‰ï¼‰"
        PluginInt[plugins/internal<br/>å¹³å°/æ¸¸æˆé›†æˆ]
        PluginExt[plugins/external<br/>ç”¨æˆ·æ’ä»¶]
    end

    Main --> Core
    Core --> EventBus
    Core --> ModuleLoader

    ModuleLoader --> AudioIn
    ModuleLoader --> LangProc
    ModuleLoader --> ExprGen
    ModuleLoader --> VirtRend
    ModuleLoader --> AudioOut
    ModuleLoader --> VisOut
    ModuleLoader --> Stream

    AudioIn --> LangProc
    LangProc --> ExprGen
    ExprGen --> VirtRend
    AudioOut --> Stream
    VisOut --> Stream

    EventBus -.-> PluginInt
    EventBus -.-> PluginExt

    style Core fill:#f9f,stroke:#333,stroke-width:4px
    style AudioIn fill:#bbf,stroke:#333,stroke-width:2px
    style LangProc fill:#bbf,stroke:#333,stroke-width:2px
    style ExprGen fill:#bbf,stroke:#333,stroke-width:2px
    style VirtRend fill:#bbf,stroke:#333,stroke-width:2px
    style AudioOut fill:#bbf,stroke:#333,stroke-width:2px
    style VisOut fill:#bbf,stroke:#333,stroke-width:2px
    style Stream fill:#bbf,stroke:#333,stroke-width:2px
    style PluginInt fill:#bfb,stroke:#333,stroke-width:2px
    style PluginExt fill:#bfb,stroke:#333,stroke-width:2px
```

### C. åŠŸèƒ½åŸŸæ•°æ®æµå›¾

```mermaid
flowchart LR
    Input[å¤–éƒ¨è¾“å…¥<br/>éº¦å…‹é£/å¼¹å¹•/æ§åˆ¶å°] --> AudioIn[audio_input]

    AudioIn -->|éŸ³é¢‘æµ| STT[STTæ¨¡å—]
    AudioIn -->|æ–‡æœ¬| LLM[LLMæ¨¡å—]

    STT -->|è¯†åˆ«æ–‡æœ¬| LLM
    LLM -->|ç†è§£æ–‡æœ¬| ExprGen[expression_generation]

    ExprGen -->|è¡¨æƒ…å‚æ•°| VirtRend[virtual_rendering]
    VirtRend -->|æ¸²æŸ“æŒ‡ä»¤| Renderer[VTS/Warudo/OBS]

    LLM -->|å›å¤æ–‡æœ¬| TTS[TTSæ¨¡å—]
    TTS -->|è¯­éŸ³æ•°æ®| AudioOut[audio_output]

    LLM -->|å­—å¹•æ–‡æœ¬| Subtitle[subtitleæ¨¡å—]
    Subtitle --> VisOut[visual_output]

    Renderer --> Stream[streaming]
    AudioOut --> Stream
    VisOut --> Stream

    Stream --> Output[ç›´æ’­æ¨æµ<br/>OBS/å¹³å°]

    style Input fill:#fe9,stroke:#333,stroke-width:2px
    style Output fill:#fe9,stroke:#333,stroke-width:2px
    style AudioIn fill:#bbf,stroke:#333,stroke-width:2px
    style LangProc fill:#bbf,stroke:#333,stroke-width:2px
    style ExprGen fill:#bbf,stroke:#333,stroke-width:2px
    style VirtRend fill:#bbf,stroke:#333,stroke-width:2px
    style AudioOut fill:#bbf,stroke:#333,stroke-width:2px
    style VisOut fill:#bbf,stroke:#333,stroke-width:2px
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0
**æœ€åæ›´æ–°**ï¼š2025-01-15
**çŠ¶æ€**ï¼šè®¾è®¡é˜¶æ®µï¼Œå¾…è¯„å®¡
